import{_ as e,r as o,o as c,c as l,b as n,a as t,w as p,d as s,e as i}from"./app.4c8b15c1.js";const u={},r=n("h1",{id:"\u524D\u7AEF\u76D1\u63A7sdk\u6280\u672F\u5B9E\u73B0\u65B9\u6848",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u524D\u7AEF\u76D1\u63A7sdk\u6280\u672F\u5B9E\u73B0\u65B9\u6848","aria-hidden":"true"},"#"),s(" \u524D\u7AEF\u76D1\u63A7SDK\u6280\u672F\u5B9E\u73B0\u65B9\u6848")],-1),k={class:"table-of-contents"},d=s("\u6982\u8FF0"),v=s("\u5B9E\u73B0\u601D\u8DEF"),m=s("\u5B9E\u73B0\u601D\u8DEF\u68B3\u7406"),b=s("\u4EE3\u7801\u7ED3\u6784"),y=s("\u6570\u636E\u7ED3\u6784\u8BBE\u8BA1"),g=s("\u516C\u5171\u6570\u636E"),h=s("\u7A33\u5B9A\u6027\u76D1\u63A7"),f=s("\u57CB\u70B9\u4E0A\u62A5"),w=s("\u7528\u6237\u505C\u7559\u53CApv\u4E0A\u62A5"),q=s("\u6027\u80FD\u6307\u6807\u76D1\u63A7"),x=s("\u957F\u4EFB\u52A1\u76D1\u63A7(\u5361\u987F)"),j=s("\u6838\u5FC3\u529F\u80FD\u6A21\u5757\u8BBE\u8BA1"),T=s("JavaScript\u9519\u8BEF\u76D1\u63A7"),_=s("\u767D\u5C4F\u76D1\u63A7"),E=s("fetch \u8BF7\u6C42\u76D1\u63A7"),S=s("XHR \u8BF7\u6C42\u76D1\u63A7"),P=s("\u9875\u9762\u505C\u7559\u548C\u8BBF\u95EE\u4E0A\u62A5"),L=s("\u957F\u4EFB\u52A1\u76D1\u63A7 (\u5361\u987F)"),R=s("\u52A0\u8F7D\u65F6\u95F4\u548C\u6027\u80FD\u6307\u6807\u76D1\u63A7"),C=s("\u57CB\u70B9\u4E0A\u62A5"),D=s("\u6570\u636E\u4E0A\u62A5"),I=s("\u5DE5\u5177\u7C7B"),F=s("\u5165\u53E3\u6587\u4EF6"),O=s("jest\u5355\u5143\u6D4B\u8BD5\u6848\u4F8B"),H=s("\u9879\u76EE\u914D\u7F6E\u6587\u4EF6"),N=i(`<h2 id="\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u6982\u8FF0" aria-hidden="true">#</a> \u6982\u8FF0</h2><p>\u672CSDK\u65E8\u5728\u4E3A\u524D\u7AEF\u5F00\u53D1\u8005\u63D0\u4F9B\u4E00\u4E2A\u8F7B\u91CF\u7EA7\u4E14\u529F\u80FD\u5F3A\u5927\u7684\u76D1\u63A7\u89E3\u51B3\u65B9\u6848\uFF0C\u5E2E\u52A9\u5F00\u53D1\u8005\u53CA\u65F6\u53D1\u73B0\u548C\u89E3\u51B3\u524D\u7AEF\u5E94\u7528\u4E2D\u7684\u5404\u79CD\u95EE\u9898\u3002SDK\u8986\u76D6\u4E86\u4ECEJavaScript\u8FD0\u884C\u65F6\u9519\u8BEF\u76D1\u63A7\u3001 \u8D44\u6E90\u52A0\u8F7D\u76D1\u63A7\u5230\u7528\u6237\u884C\u4E3A\u57CB\u70B9\u7EDF\u8BA1\u7B49\u5E7F\u6CDB\u7684\u76D1\u63A7\u9700\u6C42\uFF0C\u5E76\u652F\u6301\u591A\u79CD\u6570\u636E\u4E0A\u62A5\u65B9\u5F0F\u4EE5\u786E\u4FDD\u6570\u636E\u7684\u53EF\u9760\u6027\u548C\u5B9E\u65F6\u6027\u3002</p><h2 id="\u5B9E\u73B0\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u601D\u8DEF" aria-hidden="true">#</a> \u5B9E\u73B0\u601D\u8DEF</h2><h3 id="\u5B9E\u73B0\u601D\u8DEF\u68B3\u7406" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u601D\u8DEF\u68B3\u7406" aria-hidden="true">#</a> \u5B9E\u73B0\u601D\u8DEF\u68B3\u7406</h3><h4 id="\u524D\u7AEF\u76D1\u63A7\u7CFB\u7EDF\u5B9E\u73B0-\u7A33\u5B9A\u6027" tabindex="-1"><a class="header-anchor" href="#\u524D\u7AEF\u76D1\u63A7\u7CFB\u7EDF\u5B9E\u73B0-\u7A33\u5B9A\u6027" aria-hidden="true">#</a> \u524D\u7AEF\u76D1\u63A7\u7CFB\u7EDF\u5B9E\u73B0\uFF08\u7A33\u5B9A\u6027\uFF09</h4><ul><li>js\u62A5\u9519\u76D1\u63A7 <ul><li>\u8BED\u6CD5\u9519\u8BEF\uFF0C\uFF08\u5F00\u53D1\u9636\u6BB5\u9759\u6001\u4EE3\u7801\u68C0\u67E5 \u5982esLInt\u7B49\u5DE5\u5177\uFF09</li><li>\u540C\u6B65\u9519\u8BEF\uFF0C\uFF08type catch\u6355\u83B7, window.onerror\uFF0C addEventListener(&#39;error&#39;\uFF09\u90FD\u53EF\u4EE5\uFF09</li><li>\u5F02\u6B65\u9519\u8BEF, \uFF08 window.onerror\uFF0C addEventListener(&#39;error&#39;\uFF09\u90FD\u53EF\u4EE5\uFF09</li></ul></li><li>promise\u5F02\u5E38\u76D1\u63A7 (unhandledrejection, \u6216\u8005promise\u7684catch\uFF09</li><li>\u8D44\u6E90\u52A0\u8F7D\u9519\u8BEF\u76D1\u63A7\uFF08ael(&#39;error&#39;)</li><li>\u63A5\u53E3\u8BF7\u6C42\u5F02\u5E38\u76D1\u63A7 (XMLHttpRequest,\u76D1\u542Cerror) 0 fetch\u8BF7\u6C42\u76D1\u63A7</li><li>\u767D\u5C4F\u76D1\u63A7 elementsFromPoint</li><li>\u624B\u52A8\u4E0A\u62A5\uFF0Ctry catch, \u5176\u4ED6\u56DE\u8C03\u5931\u8D25\u7B49</li></ul><h4 id="\u7528\u6237\u4F53\u9A8C-\u6027\u80FD\u6307\u6807" tabindex="-1"><a class="header-anchor" href="#\u7528\u6237\u4F53\u9A8C-\u6027\u80FD\u6307\u6807" aria-hidden="true">#</a> \uFF08\u7528\u6237\u4F53\u9A8C\uFF09\u6027\u80FD\u6307\u6807</h4><ul><li>\u52A0\u8F7D\u65F6\u95F4\uFF08\u5404\u9636\u6BB5\u7684\u52A0\u8F7D\u65F6\u95F4\uFF09</li><li>TTFB\uFF08\u9996\u5B57\u8282\u65F6\u95F4\uFF09</li><li>FP\uFF08\u9996\u6B21\u7ED8\u5236\uFF09</li><li>FCP\uFF08\u9996\u6B21\u5185\u5BB9\u7ED8\u5236\uFF09</li><li>FMP\uFF08\u9996\u6B21\u6709\u610F\u4E49\u7ED8\u5236\uFF09</li><li>FID\uFF08\u9996\u6B21\u8F93\u5165\u5EF6\u8FDF\uFF09</li><li>\u5361\u987F\uFF08\u8D85\u8FC750ms\u957F\u4EFB\u52A1\uFF09</li></ul><h4 id="\u4E1A\u52A1\u5206\u6790\u4F9D\u636E" tabindex="-1"><a class="header-anchor" href="#\u4E1A\u52A1\u5206\u6790\u4F9D\u636E" aria-hidden="true">#</a> \uFF08\u4E1A\u52A1\u5206\u6790\u4F9D\u636E\uFF09</h4><ul><li>pv \uFF08\u7CFB\u7EDF\u8BBF\u95EE\u91CF\uFF09\uFF08\u521D\u59CB\u5316sdk\u4E0A\u62A5\u4E00\u6761)</li><li>uv \uFF08\u7528\u6237\u8BBF\u95EE\u91CF\uFF09\uFF08\u53EA\u4E0A\u62A5pv, \u8FC7\u6EE4\u540E\u5F97\u5230uv,\u6839\u636E\u7528\u6237id\u6216ip\u8FC7\u6EE4\uFF09</li><li>\u7528\u6237\u9875\u9762\u505C\u7559\u65F6\u95F4 \uFF08history\u8DEF\u7531 hash\u8DEF\u7531\uFF09</li></ul><h4 id="\u7528\u6237\u57CB\u70B9\u7EDF\u8BA1" tabindex="-1"><a class="header-anchor" href="#\u7528\u6237\u57CB\u70B9\u7EDF\u8BA1" aria-hidden="true">#</a> \u7528\u6237\u57CB\u70B9\u7EDF\u8BA1</h4><ul><li>\u624B\u52A8\u57CB\u70B9\uFF08\u76F4\u63A5\u8C03\u7528\u63A5\u53E3\uFF0C\u6216\u914D\u7F6E\u6807\u7B7E\u5C5E\u6027\uFF09</li><li>\u65E0\u75D5\u57CB\u70B9\uFF08\u5168\u5C40\uFF09\u53EF\u624B\u52A8\u6807\u8BB0\u503C</li></ul><h4 id="\u6570\u636E\u4E0A\u62A5" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u4E0A\u62A5" aria-hidden="true">#</a> \u6570\u636E\u4E0A\u62A5</h4><ul><li>xhr\u8BF7\u6C42\u63A5\u53E3\u4E0A\u62A5\uFF08\u5982\u670D\u52A1\u5668\u4E0D\u540C\u9700\u8DE8\u57DF\uFF0C\u5237\u65B0\u91CD\u65B0\u6253\u5F00\u53EF\u80FD\u4E22\u5931\u6570\u636E\uFF09</li><li>img\u6807\u7B7E\u4E0A\u62A5\uFF08\u907F\u514D\u4E86\u8DE8\u57DF\u95EE\u9898\uFF0C\u4F46\u4E0D\u9002\u5408\u5927\u91CF\u6570\u636E\u4E0A\u62A5\uFF0Curl\u957F\u5EA6\u9650\u5236\uFF09</li><li>sendBeacon\uFF08\u65E0\u9700\u8DE8\u57DF\uFF0C\u4E0D\u4F1A\u5237\u65B0\u4E22\u5931\u6570\u636E\uFF0C\u6709\u517C\u5BB9\u95EE\u9898\uFF09</li><li>\u5EF6\u8FDF\u4E0A\u62A5\uFF0C\u7F13\u5B58\u5230\u5185\u5B58\uFF0C\u9875\u9762\u5378\u8F7D\u65F6\u67E5\u770B\u6709\u65E0\u4E3A\u4E0A\u62A5\u7684\u7F13\u5B58</li><li>\u4E0A\u62A5\u683C\u5F0F\u95EE\u9898\uFF1A\u6570\u7EC4 or \u5BF9\u8C61\uFF08\u6570\u7EC4\uFF09</li><li>\u5408\u5E76\u4E0A\u62A5\uFF1A\u65E0\u75D5\u57CB\u70B9\u7B49\u5927\u91CF\u6570\u636E\u4E0A\u62A5\u7684\u60C5\u51B5\u9002\u7528\uFF1B</li><li>\u603B\uFF1A\u4E00\u822C\u91C7\u7528sendBeacon\u4E0A\u62A5\u548Cimg\u6807\u7B7E\u4E0A\u62A5\u7ED3\u5408\u7684\u65B9\u5F0F\uFF1B</li></ul><h4 id="sdk\u5F00\u53D1\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#sdk\u5F00\u53D1\u601D\u8DEF" aria-hidden="true">#</a> SDK\u5F00\u53D1\u601D\u8DEF</h4><ul><li>\u6570\u636E\u91C7\u96C6</li><li>\u521D\u59CB\u5316\u914D\u7F6E</li><li>\u66B4\u9732SDK\u521D\u59CB\u5316\u53CA\u5176\u4ED6\u65B9\u6CD5</li><li>\u624B\u52A8\u4E0A\u62A5\u65B9\u6CD5\uFF0C\u4E0A\u62A5\u63A5\u53E3\u6CE8\u5165\u548C\u5206\u7C7B</li></ul><h4 id="\u6253\u5305\u6D4B\u8BD5\u53D1\u5E03\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u6253\u5305\u6D4B\u8BD5\u53D1\u5E03\u6D41\u7A0B" aria-hidden="true">#</a> \u6253\u5305\u6D4B\u8BD5\u53D1\u5E03\u6D41\u7A0B</h4><ul><li>webpack\u914D\u7F6E balel \u538B\u7F29\u7B49</li><li>\u6253\u5305\u53D1\u5E03npm,\u5B89\u88C5\u4F7F\u7528\u6D4B\u8BD5</li><li>\u5355\u5143\u6D4B\u8BD5 \uFF08\u51FD\u6570\u7C7B\u5355\u5143\uFF09</li><li>\u96C6\u6210\u6D4B\u8BD5 \uFF08\u76D1\u542C\uFF0C\u8BF7\u6C42\u7C7B\u6D4B\u8BD5\uFF09</li><li>\u4F7F\u7528\u6587\u6863\u6574\u7406</li><li>\u53D1\u5E03\u5230npm+\u5B8C\u6574\u6587\u6863</li><li>\u76D1\u63A7SDK\u5F00\u53D1\u601D\u8DEF\u53CA\u535A\u5BA2</li></ul><h4 id="\u540E\u7EED\u4F18\u5316idea" tabindex="-1"><a class="header-anchor" href="#\u540E\u7EED\u4F18\u5316idea" aria-hidden="true">#</a> \u540E\u7EED\u4F18\u5316idea</h4><ul><li>soure-map</li><li>\u53C2\u8003\u5176\u4ED6\u535A\u5BA2\u548C\u6210\u719F\u7F51\u7AD9\u53CAGPT......</li></ul><h2 id="\u4EE3\u7801\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u4EE3\u7801\u7ED3\u6784" aria-hidden="true">#</a> \u4EE3\u7801\u7ED3\u6784</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ddd-monitor-sdk/
\u251C\u2500\u2500 src/
\u2502   \u251C\u2500\u2500 lib/
\u2502   \u2502   \u251C\u2500\u2500 actionTracker.js
\u2502   \u2502   \u251C\u2500\u2500 blankScreen.js
\u2502   \u2502   \u251C\u2500\u2500 fetch.js
\u2502   \u2502   \u251C\u2500\u2500 jsError.js
\u2502   \u2502   \u251C\u2500\u2500 longTask.js
\u2502   \u2502   \u251C\u2500\u2500 pageTracker.js
\u2502   \u2502   \u251C\u2500\u2500 timing.js
\u2502   \u2502   \u251C\u2500\u2500 xhr.js
\u2502   \u2502   \u2514\u2500\u2500 utils/
\u2502   \u2502       \u251C\u2500\u2500 cache.js
\u2502   \u2502       \u251C\u2500\u2500 formatTime.js
\u2502   \u2502       \u251C\u2500\u2500 getLastEvent.js
\u2502   \u2502       \u251C\u2500\u2500 getSelector.js
\u2502   \u2502       \u251C\u2500\u2500 onload.js
\u2502   \u2502       \u251C\u2500\u2500 report.js
\u2502   \u2502       \u251C\u2500\u2500 util.js
\u2502   \u2502       \u2514\u2500\u2500 index.js
\u2502   \u2514\u2500\u2500 test/
\u2502       \u251C\u2500\u2500 cache.test.js
\u2502       \u251C\u2500\u2500 formatTime.test.js
\u2502       \u251C\u2500\u2500 getLastEvent.test.js
\u2502       \u251C\u2500\u2500 getSelector.test.js
\u2502       \u251C\u2500\u2500 onload.test.js
\u2502       \u2514\u2500\u2500 util.test.js
\u251C\u2500\u2500 .babelrc
\u251C\u2500\u2500 jest.config.js
\u251C\u2500\u2500 package.json
\u251C\u2500\u2500 README.md
\u251C\u2500\u2500 webpack.config.js
\u2514\u2500\u2500 yarn.lock
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6570\u636E\u7ED3\u6784\u8BBE\u8BA1" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u7ED3\u6784\u8BBE\u8BA1" aria-hidden="true">#</a> \u6570\u636E\u7ED3\u6784\u8BBE\u8BA1</h2><h3 id="\u516C\u5171\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u516C\u5171\u6570\u636E" aria-hidden="true">#</a> \u516C\u5171\u6570\u636E</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9879\u76EE\u7684appId</span>
  <span class="token literal-property property">userId</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237id</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B\uFF1Aerror/action/visit/user</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F53\u524D\u9875title</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F53\u524D\u9875url</span>
  <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F53\u524D\u65F6\u95F4\u6233</span>
  <span class="token literal-property property">userAgent</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F53\u524D\u6D4F\u89C8\u5668\u4FE1\u606F</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u7A33\u5B9A\u6027\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#\u7A33\u5B9A\u6027\u76D1\u63A7" aria-hidden="true">#</a> \u7A33\u5B9A\u6027\u76D1\u63A7</h3><h4 id="\u8D44\u6E90\u52A0\u8F7D\u5F02\u5E38" tabindex="-1"><a class="header-anchor" href="#\u8D44\u6E90\u52A0\u8F7D\u5F02\u5E38" aria-hidden="true">#</a> \u8D44\u6E90\u52A0\u8F7D\u5F02\u5E38</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stability&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u7A33\u5B9A\u6027\u6307\u6807</span>
    <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&#39;resourceError&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9519\u8BEF\u7C7B\u578B</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u6587\u4EF6</span>
    <span class="token literal-property property">tagName</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u6807\u7B7E\u540D</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="js\u52A0\u8F7D\u9519\u8BEF" tabindex="-1"><a class="header-anchor" href="#js\u52A0\u8F7D\u9519\u8BEF" aria-hidden="true">#</a> js\u52A0\u8F7D\u9519\u8BEF</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stability&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u7A33\u5B9A\u6027\u6307\u6807</span>
    <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&#39;jsError&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9519\u8BEF\u7C7B\u578B</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u4FE1\u606F</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u6587\u4EF6</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u4F4D\u7F6E \u884C\uFF1A\u5217</span>
    <span class="token literal-property property">stack</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5806\u6808\u4FE1\u606F \u54EA\u4E2A\u65B9\u6CD5\u8C03\u7528\u54EA\u4E00\u5757\u513F</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="promise\u9519\u8BEF" tabindex="-1"><a class="header-anchor" href="#promise\u9519\u8BEF" aria-hidden="true">#</a> promise\u9519\u8BEF</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stability&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u7A33\u5B9A\u6027\u6307\u6807</span>
    <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&#39;promiseError&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9519\u8BEF\u7C7B\u578B</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u4FE1\u606F</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u6587\u4EF6</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u4F4D\u7F6E \u884C\uFF1A\u5217</span>
    <span class="token literal-property property">stack</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5806\u6808\u4FE1\u606F \u54EA\u4E2A\u65B9\u6CD5\u8C03\u7528\u54EA\u4E00\u5757\u513F</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u624B\u52A8\u4E0A\u62A5\u5F02\u5E38" tabindex="-1"><a class="header-anchor" href="#\u624B\u52A8\u4E0A\u62A5\u5F02\u5E38" aria-hidden="true">#</a> \u624B\u52A8\u4E0A\u62A5\u5F02\u5E38</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F02\u5E38\u4FE1\u606F</span>
    <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F02\u5E38\u6807\u9898</span>
    <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&#39;catchError&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9519\u8BEF\u7C7B\u578B\uFF0C\u81EA\u5B9A\u4E49</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="xhr-\u8BF7\u6C42\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#xhr-\u8BF7\u6C42\u76D1\u63A7" aria-hidden="true">#</a> XHR \u8BF7\u6C42\u76D1\u63A7</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;xhr&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u7A33\u5B9A\u6027\u6307\u6807</span>
    <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>  <span class="token comment">// load, error, abort \u8BF7\u6C42\u7C7B\u578B</span>
    <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u8BF7\u6C42\u8DEF\u5F84</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u72B6\u6001\u7801</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u6301\u7EED\u65F6\u95F4</span>
    <span class="token literal-property property">response</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u54CD\u5E94\u4F53</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5165\u53C2</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="fetch-\u8BF7\u6C42\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#fetch-\u8BF7\u6C42\u76D1\u63A7" aria-hidden="true">#</a> fetch \u8BF7\u6C42\u76D1\u63A7</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u7A33\u5B9A\u6027\u6307\u6807</span>
    <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u54CD\u5E94\u7C7B\u578B\uFF1AloadError\uFF08\u8FDE\u63A5\u9519\u8BEF\uFF09\uFF0Cerror\uFF08\u89E3\u6790\u9519\u8BEF\uFF09</span>
    <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u8BF7\u6C42\u5730\u5740url</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u72B6\u6001\u7801</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u8017\u65F6</span>
    <span class="token literal-property property">response</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u54CD\u5E94\u4F53</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u8BF7\u6C42\u65B9\u5F0F</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5165\u53C2</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u57CB\u70B9\u4E0A\u62A5" tabindex="-1"><a class="header-anchor" href="#\u57CB\u70B9\u4E0A\u62A5" aria-hidden="true">#</a> \u57CB\u70B9\u4E0A\u62A5</h3><h4 id="\u5168\u5C40\u57CB\u70B9" tabindex="-1"><a class="header-anchor" href="#\u5168\u5C40\u57CB\u70B9" aria-hidden="true">#</a> \u5168\u5C40\u57CB\u70B9</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;action&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;tracker&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u57CB\u70B9\u4E0A\u62A5</span>
    <span class="token literal-property property">actionType</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u884C\u4E3A\u7C7B\u578B\uFF1Aclick,submit\u7B49</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u624B\u52A8\u6DFB\u52A0data-target\u5C5E\u6027\u83B7\u53D6\u5C5E\u6027\u503C</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u624B\u52A8\u57CB\u70B9" tabindex="-1"><a class="header-anchor" href="#\u624B\u52A8\u57CB\u70B9" aria-hidden="true">#</a> \u624B\u52A8\u57CB\u70B9</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;action&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;tracker&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u57CB\u70B9\u4E0A\u62A5</span>
    <span class="token literal-property property">actionType</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u884C\u4E3A\u7C7B\u578B\uFF1Aclick,submit\u7B49</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u624B\u52A8\u6DFB\u52A0data-target\u5C5E\u6027\u83B7\u53D6\u5C5E\u6027\u503C</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u7528\u6237\u505C\u7559\u53CApv\u4E0A\u62A5" tabindex="-1"><a class="header-anchor" href="#\u7528\u6237\u505C\u7559\u53CApv\u4E0A\u62A5" aria-hidden="true">#</a> \u7528\u6237\u505C\u7559\u53CApv\u4E0A\u62A5</h3><h4 id="\u9875\u9762\u505C\u7559\u65F6\u95F4" tabindex="-1"><a class="header-anchor" href="#\u9875\u9762\u505C\u7559\u65F6\u95F4" aria-hidden="true">#</a> \u9875\u9762\u505C\u7559\u65F6\u95F4</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;stayTimePage&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stayView&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u9875\u9762\u505C\u7559</span>
    <span class="token literal-property property">stayTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u505C\u7559\u65F6\u95F4\u503C</span>
    <span class="token literal-property property">page</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u505C\u7559\u9875\u9762url</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="pv" tabindex="-1"><a class="header-anchor" href="#pv" aria-hidden="true">#</a> pv</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;pv&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stayView&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u9875\u9762\u505C\u7559</span>
    <span class="token literal-property property">effectiveType</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7F51\u7EDC\u73AF\u5883</span>
    <span class="token literal-property property">rtt</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F80\u8FD4\u65F6\u95F4</span>
    <span class="token literal-property property">screen</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u8BBE\u5907\u5206\u8FA8\u7387</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u7CFB\u7EDF\u603B\u505C\u7559\u65F6\u95F4" tabindex="-1"><a class="header-anchor" href="#\u7CFB\u7EDF\u603B\u505C\u7559\u65F6\u95F4" aria-hidden="true">#</a> \u7CFB\u7EDF\u603B\u505C\u7559\u65F6\u95F4</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;stayTimeSystem&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stayView&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5927\u7C7B\u578B\uFF1A\u9875\u9762\u505C\u7559</span>
    <span class="token literal-property property">stayTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u505C\u7559\u65F6\u95F4\u503C</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6027\u80FD\u6307\u6807\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#\u6027\u80FD\u6307\u6807\u76D1\u63A7" aria-hidden="true">#</a> \u6027\u80FD\u6307\u6807\u76D1\u63A7</h3><h4 id="\u9996\u6B21\u8F93\u5165\u5EF6\u8FDF" tabindex="-1"><a class="header-anchor" href="#\u9996\u6B21\u8F93\u5165\u5EF6\u8FDF" aria-hidden="true">#</a> \u9996\u6B21\u8F93\u5165\u5EF6\u8FDF</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;firstInputDelay&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;experience&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237\u4F53\u9A8C\u6307\u6807</span>
    <span class="token literal-property property">inputDelay</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5EF6\u8FDF\u7684\u65F6\u95F4</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5904\u7406\u7684\u8017\u65F6</span>
    <span class="token literal-property property">startTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F00\u59CB\u5904\u7406\u7684\u65F6\u95F4</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20\u8DEF\u5F84</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u65F6\u95F4\u6307\u6807" tabindex="-1"><a class="header-anchor" href="#\u65F6\u95F4\u6307\u6807" aria-hidden="true">#</a> \u65F6\u95F4\u6307\u6807</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;timing&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;experience&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237\u4F53\u9A8C\u6307\u6807</span>
    <span class="token literal-property property">connectTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// TCP\u8FDE\u63A5\u8017\u65F6</span>
    <span class="token literal-property property">ttfbTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9996\u5B57\u8282\u5230\u8FBE\u65F6\u95F4</span>
    <span class="token literal-property property">responseTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// response\u54CD\u5E94\u8017\u65F6</span>
    <span class="token literal-property property">parseDOMTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// DOM\u89E3\u6790\u6E32\u67D3\u7684\u65F6\u95F4</span>
    <span class="token literal-property property">domContentLoadedTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// DOMContentLoaded\u4E8B\u4EF6\u56DE\u8C03\u8017\u65F6</span>
    <span class="token literal-property property">timeToInteractive</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9996\u6B21\u53EF\u4EA4\u4E92\u65F6\u95F4</span>
    <span class="token literal-property property">loadTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5B8C\u6574\u7684\u52A0\u8F7D\u65F6\u95F4</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u6027\u80FD\u6307\u6807" tabindex="-1"><a class="header-anchor" href="#\u6027\u80FD\u6307\u6807" aria-hidden="true">#</a> \u6027\u80FD\u6307\u6807</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;paint&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;experience&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237\u4F53\u9A8C\u6307\u6807</span>
    <span class="token literal-property property">firstPaint</span><span class="token operator">:</span> &#39;<span class="token punctuation">,</span> <span class="token comment">// \u9996\u6B21\u7ED8\u5236\u65F6\u95F4</span>
    <span class="token literal-property property">firstContentPaint</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9996\u6B21\u5185\u5BB9\u7ED8\u5236\u65F6\u95F4</span>
    <span class="token literal-property property">firstMeaningfulPaint</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9996\u6B21\u6709\u610F\u4E49\u7ED8\u5236\u65F6\u95F4</span>
    <span class="token literal-property property">largestContentfulPaint</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u6700\u5927\u5185\u5BB9\u7ED8\u5236\u65F6\u95F4</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u957F\u4EFB\u52A1\u76D1\u63A7-\u5361\u987F" tabindex="-1"><a class="header-anchor" href="#\u957F\u4EFB\u52A1\u76D1\u63A7-\u5361\u987F" aria-hidden="true">#</a> \u957F\u4EFB\u52A1\u76D1\u63A7(\u5361\u987F)</h3><h4 id="\u957F\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#\u957F\u4EFB\u52A1" aria-hidden="true">#</a> \u957F\u4EFB\u52A1</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;longTask&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7C7B\u578B</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;experience&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237\u4F53\u9A8C\u6307\u6807</span>
    <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u4E8B\u4EF6\u7C7B\u578B</span>
    <span class="token literal-property property">startTime</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u5F00\u59CB\u65F6\u95F4</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u6301\u7EED\u65F6\u95F4</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20\u8DEF\u5F84</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6838\u5FC3\u529F\u80FD\u6A21\u5757\u8BBE\u8BA1" tabindex="-1"><a class="header-anchor" href="#\u6838\u5FC3\u529F\u80FD\u6A21\u5757\u8BBE\u8BA1" aria-hidden="true">#</a> \u6838\u5FC3\u529F\u80FD\u6A21\u5757\u8BBE\u8BA1</h2><h3 id="javascript\u9519\u8BEF\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#javascript\u9519\u8BEF\u76D1\u63A7" aria-hidden="true">#</a> JavaScript\u9519\u8BEF\u76D1\u63A7</h3><h4 id="\u529F\u80FD\u63CF\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u63CF\u8FF0" aria-hidden="true">#</a> \u529F\u80FD\u63CF\u8FF0</h4><p>\u6355\u83B7\u5E76\u4E0A\u62A5\u524D\u7AEF<strong>JavaScript\u8FD0\u884C\u65F6\u7684\u9519\u8BEF</strong>\uFF0C<strong>\u672A\u5904\u7406\u7684Promise\u9519\u8BEF</strong>\u3001<strong>\u8D44\u6E90\u52A0\u8F7D\u9519\u8BEF</strong>\u3002 \u901A\u8FC7\u76D1\u542C<code>window.addEventListener(&#39;error&#39;)</code>\u3001<code>window.addEventListener(&#39;unhandledrejection&#39;\uFF09</code>\u4E8B\u4EF6\uFF0C \u6355\u83B7\u9519\u8BEF\u4FE1\u606F\uFF0C\u5E76\u683C\u5F0F\u5316\u540E\u4E0A\u62A5\u81F3\u670D\u52A1\u5668\u3002</p><ul><li><code>window.addEventListener(&#39;error&#39;)</code>\uFF1A\u6355\u83B7js\u9519\u8BEF\u548C\u8D44\u6E90\u52A0\u8F7D\u9519\u8BEF\u3002</li><li><code>window.addEventListener(&#39;unhandledrejection&#39;\uFF09</code>\uFF1A\u6355\u83B7Promise\u9519\u8BEF</li></ul><h4 id="\u6280\u672F\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ddd-monitor-sdk\\src\\lib\\jsError.js</span>

<span class="token keyword">import</span> getSelector <span class="token keyword">from</span> <span class="token string">&quot;../utils/getSelector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getLastEvent <span class="token keyword">from</span> <span class="token string">&#39;../utils/getLastEvent&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>lazyReport<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils/report&quot;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u9519\u8BEF\u6355\u83B7\uFF1A js\uFF0Cpromise,\u8D44\u6E90\u52A0\u8F7D
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">injectJsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> isHideResourceError <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_is_hide_resource_error_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// \u76D1\u542C\u5168\u5C40\u672A\u6355\u83B7\u9519\u8BEF</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6355\u83B7\u6700\u540E\u4E00\u4E2A\u4EA4\u4E92\u4E8B\u4EF6\uFF08\u6700\u65B0\u6807\u51C6pointerEvent\u65E0\u6CD5\u83B7\u53D6path)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> event<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">||</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// ------- resource error --------</span>
            <span class="token comment">// img src\u4E0A\u62A5\u8FC7\u6EE4</span>
            <span class="token keyword">const</span> reportUrl <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_url_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> url <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">||</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isHideResourceError<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>reportUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stability&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7A33\u5B9A\u6027\u6307\u6807</span>
                        <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&#39;resourceError&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u8D44\u6E90\u52A0\u8F7D\u9519\u8BEF</span>
                        <span class="token literal-property property">filename</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">||</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>href<span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u6587\u4EF6</span>
                        <span class="token literal-property property">tagName</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName<span class="token punctuation">,</span> <span class="token comment">// \u6807\u7B7E\u540D</span>
                        <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>

            <span class="token comment">// --------  js error ---------</span>
            <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stability&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7A33\u5B9A\u6027\u6307\u6807</span>
                <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&#39;jsError&#39;</span><span class="token punctuation">,</span> <span class="token comment">// js\u6267\u884C\u9519\u8BEF</span>
                <span class="token literal-property property">message</span><span class="token operator">:</span> event<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u4FE1\u606F</span>
                <span class="token literal-property property">filename</span><span class="token operator">:</span> event<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u6587\u4EF6</span>
                <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>event<span class="token punctuation">.</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>event<span class="token punctuation">.</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u4F4D\u7F6E \u884C\uFF1A\u5217</span>
                <span class="token literal-property property">stack</span><span class="token operator">:</span> <span class="token function">getLines</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// \u5806\u6808\u4FE1\u606F \u54EA\u4E2A\u65B9\u6CD5\u8C03\u7528\u54EA\u4E00\u5757\u513F</span>
                <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// ------  promise error  --------</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;unhandledrejection&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u83B7\u53D6\u5230\u6700\u540E\u4E00\u4E2A\u4EA4\u4E92\u4E8B\u4EF6</span>
        <span class="token keyword">let</span> message<span class="token punctuation">;</span>
        <span class="token keyword">let</span> reason <span class="token operator">=</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
        <span class="token keyword">let</span> lineno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> colno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> filename<span class="token punctuation">;</span>
        <span class="token keyword">let</span> stack<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event<span class="token punctuation">.</span>reason <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            message <span class="token operator">=</span> reason<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> reason <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> matchResult <span class="token operator">=</span> reason<span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">at\\s+(.+):(\\d+):(\\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                filename <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                lineno <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                colno <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            message <span class="token operator">=</span> reason<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
            stack <span class="token operator">=</span> <span class="token function">getLines</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stability&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7A33\u5B9A\u6027\u6307\u6807</span>
            <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&#39;promiseError&#39;</span><span class="token punctuation">,</span> <span class="token comment">// js\u6267\u884C\u9519\u8BEF</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> message<span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u4FE1\u606F</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> filename<span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u6587\u4EF6</span>
            <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token comment">// \u62A5\u9519\u4F4D\u7F6E \u884C\uFF1A\u5217</span>
            <span class="token literal-property property">stack</span><span class="token operator">:</span> stack<span class="token punctuation">,</span> <span class="token comment">// \u5806\u6808\u4FE1\u606F \u54EA\u4E2A\u65B9\u6CD5\u8C03\u7528\u54EA\u4E00\u5757\u513F</span>
            <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>


    <span class="token doc-comment comment">/**
     * stack\u4FE1\u606F\u5904\u7406
     * <span class="token keyword">@param</span> <span class="token parameter">stack</span>
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span>
     */</span>
    <span class="token keyword">function</span> <span class="token function">getLines</span><span class="token punctuation">(</span><span class="token parameter">stack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> stack<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span>item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\s+at\\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;^&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * \u624B\u52A8\u6355\u83B7\u9519\u8BEF
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">errorCatcher</span><span class="token punctuation">(</span><span class="token parameter">errorTitle<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4E0A\u62A5\u9519\u8BEF</span>
    <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
        <span class="token literal-property property">error</span><span class="token operator">:</span> errorTitle<span class="token punctuation">,</span>
        <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&#39;catchError&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u767D\u5C4F\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#\u767D\u5C4F\u76D1\u63A7" aria-hidden="true">#</a> \u767D\u5C4F\u76D1\u63A7</h3><h4 id="\u529F\u80FD\u63CF\u8FF0-1" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u63CF\u8FF0-1" aria-hidden="true">#</a> \u529F\u80FD\u63CF\u8FF0</h4><ul><li>\u767D\u5C4F\u95EE\u9898\u662F\u524D\u7AEF\u5E94\u7528\u7A0B\u5E8F\u4E2D\u5E38\u89C1\u7684\u6027\u80FD\u4E0E\u7A33\u5B9A\u6027\u95EE\u9898\uFF0C\u901A\u5E38\u8868\u73B0\u4E3A\u9875\u9762\u52A0\u8F7D\u540E\uFF0C\u7528\u6237\u770B\u5230\u7684\u53EA\u662F\u7A7A\u767D\u5C4F\u5E55\uFF0C\u800C\u975E\u671F\u671B\u7684\u5185\u5BB9\u3002<br></li><li>\u767D\u5C4F\u76D1\u63A7\u7684\u4E3B\u8981\u76EE\u6807\u662F\u68C0\u6D4B\u9875\u9762\u52A0\u8F7D\u8FC7\u7A0B\u4E2D\u662F\u5426\u51FA\u73B0\u767D\u5C4F\u60C5\u51B5\uFF0C\u53CA\u65F6\u53D1\u73B0\u5E76\u8BB0\u5F55\u76F8\u5173\u4FE1\u606F\uFF0C\u4EE5\u4FBF\u540E\u7EED\u5206\u6790\u548C\u4F18\u5316\u3002<br></li><li><strong>\u5C4F\u5E55\u533A\u57DF\u786E\u5B9A</strong>\uFF1A\u4E00\u5C4F\u5E55\u4E2D\u5FC3\u70B9\u4E3A\u539F\u70B9\uFF0C\u6A2A\u5750\u6807\u6807\u8BB09\u4E2A\u70B9\u5750\u6807\u70B9\uFF0C\u7EB5\u5750\u6807\u6807\u8BB09\u4E2A\u5750\u6807\u70B9\uFF0C\u603B\u8BA118\u4E2A\u5750\u6807\u70B9\u3002</li><li><strong>\u5143\u7D20\u68C0\u67E5</strong>\uFF1A\u901A\u8FC7<code>document.elementsFromPoint</code>\u68C0\u67E5\u8FD9\u4E9B\u5750\u6807\u70B9\u4E0A\u7684\u5143\u7D20\u4FE1\u606F\u662F\u5426\u4E3A\u6709\u6548\u5750\u6807\u70B9\u3002</li><li><strong>\u6709\u6548\u5750\u6807\u70B9</strong>\uFF1A\u68C0\u67E5\u5750\u6807\u70B9\u662F\u5426\u5B58\u5728\u6709\u6548\u7684DOM\u5143\u7D20\uFF0C\u5982id,class,nodeName\uFF08\u6392\u9664<code>&lt;html&gt;</code>\u3001<code>&lt;body&gt; </code>\u3001<code>#container</code> <code>.content</code>\u8FD9\u4E9B\u76D2\u5B50\u5143\u7D20\uFF09\u3002</li><li><strong>\u767D\u5C4F\u5B9A\u4E49</strong>\uFF1A\u5982\u679C\u65E0\u6548\u5750\u6807\u70B9\u5927\u4E8E16\u4E2A\uFF0C\u5219\u5B9A\u4E49\u4E3A\u6539\u9875\u9762\u4E3A\u767D\u5C4F\u9875\u9762\u3002</li></ul><h4 id="\u6280\u672F\u5B9E\u73B0-1" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0-1" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">import</span> onload <span class="token keyword">from</span> <span class="token string">&quot;../utils/onload&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> lazyReport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/report&#39;</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * \u767D\u5C4F\u76D1\u63A7
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">blankScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> wrapperElements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;body&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;#container&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.content&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> emptyPoints <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">getSelector</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> className<span class="token punctuation">,</span> nodeName <span class="token punctuation">}</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> className <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u8FC7\u6EE4\u7A7A\u767D\u7B26 + \u62FC\u63A5 \u53EF\u80FD\u591A\u4E2AclassName  a  b   c =&gt; .a.b.c</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span>
        className
          <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>item<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">isWrapper</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapperElements<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      emptyPoints<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u521A\u5F00\u59CB\u9875\u9762\u5185\u5BB9\u4E3A\u7A7A\uFF0C\u76D1\u542C\u63A5\u53E3\u52A0\u8F7D\uFF0C\u7B49\u9875\u9762\u6E32\u67D3\u5B8C\u6210\uFF0C\u518D\u53BB\u505A\u5224\u65AD</span>
  <span class="token function">onload</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>elementsFromPoint <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> document<span class="token punctuation">.</span>elementsFromPoint <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u6D4F\u89C8\u5668\u652F\u6301 document.elementsFromPoint()</span>
      <span class="token keyword">let</span> xElements<span class="token punctuation">,</span> yElements<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        xElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span>
            window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        yElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerHeight <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">isWrapper</span><span class="token punctuation">(</span>xElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">isWrapper</span><span class="token punctuation">(</span>yElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// \u767D\u5C4F \u603B\u517118\u4E2A\u70B9  \u5982\u679C\u7A7A\u767D\u70B9\u6570\u91CF\u5927\u4E8E 16\u4E2A \u4EE3\u8868\u767D\u5C4F</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>emptyPoints <span class="token operator">&gt;=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> centerElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
            window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;blank&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">emptyPoints</span><span class="token operator">:</span> emptyPoints <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u7A7A\u767D\u70B9\u6570\u91CF</span>
          <span class="token literal-property property">screen</span><span class="token operator">:</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token punctuation">,</span>  <span class="token comment">// \u5C4F\u5E55\u5206\u8FA8\u7387</span>
          <span class="token literal-property property">viewPoint</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>  <span class="token comment">// \u89C6\u53E3\u5927\u5C0F</span>
          <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>centerElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// \u5C4F\u5E55\u4E2D\u5FC3\u70B9\u9009\u62E9\u5668</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="fetch-\u8BF7\u6C42\u76D1\u63A7-1" tabindex="-1"><a class="header-anchor" href="#fetch-\u8BF7\u6C42\u76D1\u63A7-1" aria-hidden="true">#</a> fetch \u8BF7\u6C42\u76D1\u63A7</h3><h4 id="\u529F\u80FD\u63CF\u8FF0-2" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u63CF\u8FF0-2" aria-hidden="true">#</a> \u529F\u80FD\u63CF\u8FF0</h4><ul><li><strong>\u62E6\u622A\u548C\u76D1\u63A7 fetch \u8BF7\u6C42</strong>: \u901A\u8FC7\u66FF\u6362\u539F\u751F <code>window.fetch</code> \u65B9\u6CD5\uFF0C\u5B9E\u73B0\u5BF9\u6240\u6709 fetch \u8BF7\u6C42\u7684\u62E6\u622A\u3002 \u5728\u8BF7\u6C42\u53D1\u8D77\u548C\u54CD\u5E94\u5904\u7406\u8FC7\u7A0B\u4E2D\uFF0C\u8BB0\u5F55\u8BF7\u6C42\u7684\u5F00\u59CB\u65F6\u95F4\u548C\u7ED3\u675F\u65F6\u95F4\uFF0C\u4EE5\u8BA1\u7B97\u8BF7\u6C42\u7684\u6301\u7EED\u65F6\u95F4\u3002</li><li><strong>\u5904\u7406\u54CD\u5E94\u6570\u636E</strong>\uFF1A\u5BF9\u54CD\u5E94\u6570\u636E\u8FDB\u884C\u7279\u6B8A\u5904\u7406\uFF0C\u91CD\u5199\u4E86 <code>response.json</code> \u65B9\u6CD5\uFF0C\u4EE5\u6355\u83B7\u89E3\u6790\u54CD\u5E94\u4F53\u65F6\u53EF\u80FD\u53D1\u751F\u7684\u9519\u8BEF\u3002 \u5982\u679C\u89E3\u6790\u54CD\u5E94\u4F53\u6210\u529F\uFF0C\u6B63\u5E38\u8FD4\u56DE\u6570\u636E\uFF1B\u5982\u679C\u5931\u8D25\uFF0C\u8BB0\u5F55\u89E3\u6790\u5931\u8D25\u7684\u65E5\u5FD7\u5E76\u4E0A\u62A5\u3002</li></ul><h4 id="\u6280\u672F\u5B9E\u73B0-2" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0-2" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>lazyReport<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils/report&quot;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * fetch \u8BF7\u6C42\u76D1\u63A7
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">injectFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> oldFetch <span class="token operator">=</span> window<span class="token punctuation">.</span>fetch<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">hijackFetch</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">oldFetch</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// response \u4E3A\u6D41\u6570\u636E</span>
                <span class="token keyword">const</span> oldResponseJson <span class="token operator">=</span> response<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>json<span class="token punctuation">;</span>
                response<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function-variable function">json</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>responseRest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">responseResolve<span class="token punctuation">,</span> responseReject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">oldResponseJson</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> responseRest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            <span class="token function">responseResolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">responseRejection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            <span class="token comment">// \u89E3\u6790\u54CD\u5E94\u6570\u636E\u65F6\u6355\u83B7\u9519\u8BEF</span>
                            <span class="token function">sendLogData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                url<span class="token punctuation">,</span>
                                startTime<span class="token punctuation">,</span>
                                <span class="token literal-property property">statusText</span><span class="token operator">:</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">,</span>
                                <span class="token literal-property property">status</span><span class="token operator">:</span> response<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
                                <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">response</span><span class="token operator">:</span> responseRejection<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
                                options
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                            <span class="token function">responseReject</span><span class="token punctuation">(</span>responseRejection<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">rejection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u8BB0\u5F55\u8BF7\u6C42\u5931\u8D25\u7684\u65E5\u5FD7</span>
                <span class="token function">sendLogData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    url<span class="token punctuation">,</span>
                    startTime<span class="token punctuation">,</span>
                    <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&#39;loadError&#39;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">response</span><span class="token operator">:</span> rejection<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
                    options
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>rejection<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    window<span class="token punctuation">.</span>fetch <span class="token operator">=</span> hijackFetch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> sendLogData <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
                         startTime<span class="token punctuation">,</span>
                         statusText <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
                         status <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
                         eventType<span class="token punctuation">,</span>
                         url<span class="token punctuation">,</span>
                         options<span class="token punctuation">,</span>
                         response<span class="token punctuation">,</span>
                     <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6301\u7EED\u65F6\u95F4</span>
    <span class="token keyword">let</span> duration <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>method <span class="token operator">=</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span> body<span class="token punctuation">}</span> <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// \u4E0A\u62A5\u63A5\u53E3\u8FC7\u6EE4\u6389</span>
    <span class="token keyword">const</span> reportUrl <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_url_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>reportUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stability&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7A33\u5B9A\u6027\u6307\u6807</span>
            <span class="token literal-property property">eventType</span><span class="token operator">:</span> eventType<span class="token punctuation">,</span>
            <span class="token literal-property property">pathname</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
            <span class="token literal-property property">status</span><span class="token operator">:</span> status <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> statusText<span class="token punctuation">,</span> <span class="token comment">// \u72B6\u6001\u7801</span>
            duration<span class="token punctuation">,</span>
            <span class="token literal-property property">response</span><span class="token operator">:</span> response <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u54CD\u5E94\u4F53</span>
            method<span class="token punctuation">,</span>
            <span class="token literal-property property">params</span><span class="token operator">:</span> body <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5165\u53C2</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="xhr-\u8BF7\u6C42\u76D1\u63A7-1" tabindex="-1"><a class="header-anchor" href="#xhr-\u8BF7\u6C42\u76D1\u63A7-1" aria-hidden="true">#</a> XHR \u8BF7\u6C42\u76D1\u63A7</h3><h4 id="\u529F\u80FD\u63CF\u8FF0-3" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u63CF\u8FF0-3" aria-hidden="true">#</a> \u529F\u80FD\u63CF\u8FF0</h4><ul><li>\u901A\u8FC7\u62E6\u622A\u548C\u6269\u5C55\u539F\u751F <code>XMLHttpRequest</code> \u5BF9\u8C61\uFF0C\u76D1\u63A7\u6240\u6709\u901A\u8FC7 XHR \u53D1\u8D77\u7684\u7F51\u7EDC\u8BF7\u6C42\uFF0C\u7279\u522B\u662F\u8BF7\u6C42\u7684\u6210\u529F\u4E0E\u5931\u8D25\u60C5\u51B5</li><li><strong>\u62E6\u622A\u548C\u76D1\u63A7 XHR \u8BF7\u6C42</strong>\uFF1A\u91CD\u5199 <code>XMLHttpRequest.prototype.open</code> \u65B9\u6CD5\uFF0C\u8BB0\u5F55\u8BF7\u6C42\u7684 method\uFF08HTTP\u65B9\u6CD5\uFF09\u3001url \u548C async\uFF08\u662F\u5426\u5F02\u6B65\uFF09\u53C2\u6570\u3002 \u901A\u8FC7 <code>XMLHttpRequest.prototype.send</code> \u65B9\u6CD5\uFF0C\u76D1\u63A7\u8BF7\u6C42\u7684\u5F00\u59CB\u65F6\u95F4\u548C\u7ED3\u675F\u65F6\u95F4\uFF0C\u4EE5\u8BA1\u7B97\u8BF7\u6C42\u7684\u6301\u7EED\u65F6\u95F4\u3002</li><li><strong>\u6355\u83B7\u8BF7\u6C42\u7684\u751F\u547D\u5468\u671F\u4E8B\u4EF6</strong>\uFF1A\u76D1\u542C XHR \u8BF7\u6C42\u7684\u751F\u547D\u5468\u671F\u4E8B\u4EF6\uFF0C\u5305\u62EC load\uFF08\u8BF7\u6C42\u6210\u529F\uFF09\u3001error\uFF08\u8BF7\u6C42\u5931\u8D25\uFF09\u3001abort\uFF08\u8BF7\u6C42\u4E2D\u6B62\uFF09\u7B49\u3002 \u6839\u636E\u53EF\u914D\u7F6E\u9879 <code>window[&#39;_monitor_xhr_type_&#39;]</code>\uFF0C\u9009\u62E9\u6027\u5730\u6355\u83B7\u4E0D\u540C\u7C7B\u578B\u7684\u4E8B\u4EF6\u3002</li></ul><h4 id="\u6280\u672F\u5B9E\u73B0-3" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0-3" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span> lazyReport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/report&#39;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * XHR \u8BF7\u6C42\u76D1\u63A7
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">injectXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> XMLHttpRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">;</span>
  <span class="token keyword">let</span> oldOpen <span class="token operator">=</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>open<span class="token punctuation">;</span>
  <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">open</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token keyword">async</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u628A\u4E0A\u62A5\u63A5\u53E3\u8FC7\u6EE4\u6389</span>
    <span class="token keyword">const</span> reportUrl <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_url_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>reportUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>logData <span class="token operator">=</span> <span class="token punctuation">{</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">oldOpen</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> oldSend <span class="token operator">=</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>send<span class="token punctuation">;</span>
  <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u53D1\u9001\u524D\u8BB0\u5F55\u5F00\u59CB\u65F6\u95F4</span>
      <span class="token keyword">let</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6301\u7EED\u65F6\u95F4</span>
        <span class="token keyword">let</span> duration <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
        <span class="token keyword">let</span> status <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">;</span>  <span class="token comment">// 200 500</span>
        <span class="token keyword">let</span> statusText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>  <span class="token comment">// Ok Server Error</span>

        <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;xhr&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
          <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">eventType</span><span class="token operator">:</span> type<span class="token punctuation">,</span>  <span class="token comment">// load, error, abort \u8BF7\u6C42\u7C7B\u578B</span>
          <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>logData<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token comment">// \u8BF7\u6C42\u8DEF\u5F84</span>
          <span class="token literal-property property">status</span><span class="token operator">:</span> status <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> statusText<span class="token punctuation">,</span> <span class="token comment">// \u72B6\u6001\u7801</span>
          duration<span class="token punctuation">,</span> <span class="token comment">// \u6301\u7EED\u65F6\u95F4</span>
          <span class="token literal-property property">response</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u54CD\u5E94\u4F53</span>
          <span class="token literal-property property">params</span><span class="token operator">:</span> body <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5165\u53C2</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// \u76D1\u542C\u6210\u529F\uFF0C\u5931\u8D25\uFF0C\u7684\u6240\u6709\u63A5\u53E3</span>
      <span class="token keyword">const</span> xhrType <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_xhr_type_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>xhrType <span class="token operator">===</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>xhrType <span class="token operator">===</span> <span class="token string">&#39;load&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>xhrType <span class="token operator">===</span> <span class="token string">&#39;abort&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">&quot;abort&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">oldSend</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u9875\u9762\u505C\u7559\u548C\u8BBF\u95EE\u4E0A\u62A5" tabindex="-1"><a class="header-anchor" href="#\u9875\u9762\u505C\u7559\u548C\u8BBF\u95EE\u4E0A\u62A5" aria-hidden="true">#</a> \u9875\u9762\u505C\u7559\u548C\u8BBF\u95EE\u4E0A\u62A5</h3><h4 id="\u529F\u80FD\u63CF\u8FF0-4" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u63CF\u8FF0-4" aria-hidden="true">#</a> \u529F\u80FD\u63CF\u8FF0</h4><ul><li><strong>\u9875\u9762\u505C\u7559\u65F6\u95F4\u76D1\u63A7</strong>\uFF1A\u652F\u6301 history \u8DEF\u7531\u548C hash \u8DEF\u7531\u4E24\u79CD\u65B9\u5F0F\uFF0C\u5206\u522B\u901A\u8FC7 history.pushState\u3001history.replaceState \u548C hashchange \u4E8B\u4EF6\u76D1\u542C\u6765\u89E6\u53D1\u505C\u7559\u65F6\u95F4\u7684\u8BA1\u7B97\u3002</li><li><strong>\u9875\u9762\u8BBF\u95EE\u884C\u4E3A\u4E0A\u62A5</strong>\uFF1A\u5F53\u7528\u6237\u5207\u6362\u9875\u9762\u65F6\uFF08\u901A\u8FC7 pushState\u3001replaceState\u3001hashchange \u7B49\u4E8B\u4EF6\uFF09\uFF0C\u4F1A\u5C06\u7528\u6237\u5728\u5F53\u524D\u9875\u9762\u7684\u505C\u7559\u65F6\u95F4\u4EE5\u53CA\u9875\u9762\u8DEF\u5F84\u4E0A\u62A5\uFF0C\u4EE5\u4FBF\u8FDB\u884C\u540E\u7EED\u5206\u6790\u3002 \u6301\u8BB0\u5F55\u7528\u6237\u5728\u4E0D\u540C\u9875\u9762\u7684\u8BBF\u95EE\u8DEF\u5F84\uFF0C\u5F62\u6210\u7528\u6237\u7684\u8BBF\u95EE\u8F68\u8FF9\u6570\u636E\u3002</li><li><strong>PV\uFF08\u9875\u9762\u8BBF\u95EE\u91CF\uFF09</strong>\uFF1A\u5728\u9875\u9762\u52A0\u8F7D\u5B8C\u6210\u65F6\u4E0A\u62A5\u9875\u9762\u8BBF\u95EE\u91CF\uFF08PV\uFF09\u3002\u5E76\u8BB0\u5F55\u8BBE\u5907\u7684\u7F51\u7EDC\u73AF\u5883\uFF08\u5982\u7F51\u7EDC\u7C7B\u578B\u548C\u5F80\u8FD4\u65F6\u95F4\uFF09\u4EE5\u53CA\u5C4F\u5E55\u5206\u8FA8\u7387\u3002</li><li><strong>\u7CFB\u7EDF\u603B\u8BBF\u95EE\u65F6\u95F4\u4E0A\u62A5</strong>\uFF1A\u5728\u9875\u9762\u5378\u8F7D\uFF08unload\uFF09\u65F6\u4E0A\u62A5\u7528\u6237\u5728\u6574\u4E2A\u7CFB\u7EDF\u4E2D\u7684\u603B\u505C\u7559\u65F6\u95F4\uFF0C\u4EE5\u6B64\u8861\u91CF\u7528\u6237\u5728\u8BE5\u7CFB\u7EDF\u4E2D\u7684\u53C2\u4E0E\u5EA6\u548C\u6D3B\u8DC3\u5EA6\u3002</li><li><strong>\u8DE8\u9875\u9762\u8BBF\u95EE\u65F6\u95F4\u8DDF\u8E2A</strong>\uFF1A\u901A\u8FC7\u91CD\u5199 pushState \u548C replaceState \u65B9\u6CD5\uFF0C\u62E6\u622A\u548C\u76D1\u63A7\u7528\u6237\u5728\u4E0D\u540C\u9875\u9762\u4E4B\u95F4\u7684\u8DF3\u8F6C\u884C\u4E3A\uFF0C\u786E\u4FDD\u80FD\u591F\u51C6\u786E\u8BB0\u5F55\u6BCF\u4E2A\u9875\u9762\u7684\u505C\u7559\u65F6\u95F4\u3002</li></ul><h4 id="\u6280\u672F\u5B9E\u73B0-4" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0-4" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token doc-comment comment">/**
 * \u9875\u9762\u505C\u7559\u548C\u8BBF\u95EE\u4E0A\u62A5
 */</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> lazyReport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/report&#39;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * history\u8DEF\u7531\u76D1\u542C
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">historyPageTracker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> beforeTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8FDB\u5165\u9875\u9762\u7684\u65F6\u95F4</span>
    <span class="token keyword">let</span> beforePage <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0A\u4E00\u4E2A\u9875\u9762</span>

    <span class="token comment">// \u83B7\u53D6\u5728\u67D0\u4E2A\u9875\u9762\u7684\u505C\u7559\u65F6\u95F4</span>
    <span class="token keyword">function</span> <span class="token function">getStayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> curTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> stayTime <span class="token operator">=</span> curTime <span class="token operator">-</span> beforeTime<span class="token punctuation">;</span>
        beforeTime <span class="token operator">=</span> curTime<span class="token punctuation">;</span>
        <span class="token keyword">return</span> stayTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u91CD\u5199pushState\u548CreplaceState\u65B9\u6CD5
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">name</span>
     * <span class="token keyword">@returns</span>
     */</span>
    <span class="token keyword">const</span> <span class="token function-variable function">createHistoryEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u62FF\u5230\u539F\u6765\u7684\u5904\u7406\u65B9\u6CD5</span>
        <span class="token keyword">const</span> origin <span class="token operator">=</span> window<span class="token punctuation">.</span>history<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">origin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>arguments <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
            window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> res<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// history.pushState</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pushState&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// history.replaceState</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;replaceState&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>pushState <span class="token operator">=</span> <span class="token function">createHistoryEvent</span><span class="token punctuation">(</span><span class="token string">&#39;pushState&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>replaceState <span class="token operator">=</span> <span class="token function">createHistoryEvent</span><span class="token punctuation">(</span><span class="token string">&#39;replaceState&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> stayTime <span class="token operator">=</span> <span class="token function">getStayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u505C\u7559\u65F6\u95F4</span>
        <span class="token keyword">const</span> currentPage <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span> <span class="token comment">// \u9875\u9762\u8DEF\u5F84</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>beforePage<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;stayTimePage&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stayView&#39;</span><span class="token punctuation">,</span>
                stayTime<span class="token punctuation">,</span>
                <span class="token literal-property property">page</span><span class="token operator">:</span> beforePage<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        beforePage <span class="token operator">=</span> currentPage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u9875\u9762load\u76D1\u542C</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// beforePage = location.href;</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// unload\u76D1\u542C</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;unload&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// history.go()\u3001history.back()\u3001history.forward() \u76D1\u542C</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;popstate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * hash\u8DEF\u7531\u76D1\u542C
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">hashPageTracker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> beforeTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8FDB\u5165\u9875\u9762\u7684\u65F6\u95F4</span>
    <span class="token keyword">let</span> beforePage <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0A\u4E00\u4E2A\u9875\u9762</span>

    <span class="token keyword">function</span> <span class="token function">getStayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> curTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> stayTime <span class="token operator">=</span> curTime <span class="token operator">-</span> beforeTime<span class="token punctuation">;</span>
        beforeTime <span class="token operator">=</span> curTime<span class="token punctuation">;</span>
        <span class="token keyword">return</span> stayTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> stayTime <span class="token operator">=</span> <span class="token function">getStayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> currentPage <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>beforePage<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;stayTimePage&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;stayView&#39;</span><span class="token punctuation">,</span>
                stayTime<span class="token punctuation">,</span>
                <span class="token literal-property property">page</span><span class="token operator">:</span> beforePage<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        beforePage <span class="token operator">=</span> currentPage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// hash\u8DEF\u7531\u76D1\u542C</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;hashchange&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9875\u9762load\u76D1\u542C</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">createHistoryEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> origin <span class="token operator">=</span> window<span class="token punctuation">.</span>history<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">origin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>arguments <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
            window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> res<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>pushState <span class="token operator">=</span> <span class="token function">createHistoryEvent</span><span class="token punctuation">(</span><span class="token string">&#39;pushState&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// history.pushState</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pushState&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * pv \u548C \u7CFB\u7EDF\u603B\u8BBF\u95EE\u65F6\u95F4\u4E0A\u62A5
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> navigator<span class="token punctuation">.</span>connection<span class="token punctuation">;</span>
    <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;pv&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stayView&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">effectiveType</span><span class="token operator">:</span> connection<span class="token punctuation">.</span>effectiveType<span class="token punctuation">,</span> <span class="token comment">//\u7F51\u7EDC\u73AF\u5883</span>
        <span class="token literal-property property">rtt</span><span class="token operator">:</span> connection<span class="token punctuation">.</span>rtt<span class="token punctuation">,</span> <span class="token comment">//\u5F80\u8FD4\u65F6\u95F4</span>
        <span class="token literal-property property">screen</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token comment">//\u8BBE\u5907\u5206\u8FA8\u7387</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
        <span class="token string">&quot;unload&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> stayTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
            <span class="token comment">// \u7CFB\u7EDF\u603B\u505C\u7559\u65F6\u95F4</span>
            <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;stayTimeSystem&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stayView&quot;</span><span class="token punctuation">,</span>
                stayTime<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token boolean">false</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u957F\u4EFB\u52A1\u76D1\u63A7-\u5361\u987F-1" tabindex="-1"><a class="header-anchor" href="#\u957F\u4EFB\u52A1\u76D1\u63A7-\u5361\u987F-1" aria-hidden="true">#</a> \u957F\u4EFB\u52A1\u76D1\u63A7 (\u5361\u987F)</h3><h4 id="\u529F\u80FD\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u6982\u8FF0" aria-hidden="true">#</a> \u529F\u80FD\u6982\u8FF0</h4><ul><li><strong>\u957F\u4EFB\u52A1\u76D1\u63A7</strong>\uFF1A\u901A\u8FC7 <code>PerformanceObserver</code> \u76D1\u63A7\u9875\u9762\u4E2D\u7684\u957F\u4EFB\u52A1\uFF08longtask\uFF09\uFF0C\u5F53\u68C0\u6D4B\u5230\u6301\u7EED\u65F6\u95F4\u8D85\u8FC7 100 \u6BEB\u79D2\u7684\u957F\u4EFB\u52A1\u65F6\uFF0C\u89E6\u53D1\u4E0A\u62A5\u673A\u5236\u3002</li><li><strong>\u5EF6\u8FDF\u4E0A\u62A5</strong>\uFF1A\u5229\u7528 <code>requestIdleCallback</code> \u5C06\u4E0A\u62A5\u4EFB\u52A1\u653E\u5728\u6D4F\u89C8\u5668\u7A7A\u95F2\u65F6\u95F4\u6267\u884C\uFF0C\u907F\u514D\u5F71\u54CD\u4E3B\u7EBF\u7A0B\u7684\u6027\u80FD\u3002</li></ul><h4 id="\u6280\u672F\u5B9E\u73B0-5" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0-5" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span>lazyReport<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils/report&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> formatTime <span class="token keyword">from</span> <span class="token string">&quot;../utils/formatTime&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getLastEvent <span class="token keyword">from</span> <span class="token string">&quot;../utils/getLastEvent&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getSelector <span class="token keyword">from</span> <span class="token string">&quot;../utils/getSelector&quot;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u957F\u4EFB\u52A1\u76D1\u63A7 (\u5361\u987F)
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">longTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>duration <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;longTask&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;experience&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237\u4F53\u9A8C\u6307\u6807</span>
                        <span class="token literal-property property">eventType</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> lastEvent<span class="token punctuation">.</span>type <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u4E8B\u4EF6\u7C7B\u578B</span>
                        <span class="token literal-property property">startTime</span><span class="token operator">:</span> <span class="token function">formatTime</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// \u5F00\u59CB\u65F6\u95F4</span>
                        <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token function">formatTime</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// \u6301\u7EED\u65F6\u95F4</span>
                        <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent
                            <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path <span class="token operator">||</span> lastEvent<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
                            <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;longtask&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u52A0\u8F7D\u65F6\u95F4\u548C\u6027\u80FD\u6307\u6807\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#\u52A0\u8F7D\u65F6\u95F4\u548C\u6027\u80FD\u6307\u6807\u76D1\u63A7" aria-hidden="true">#</a> \u52A0\u8F7D\u65F6\u95F4\u548C\u6027\u80FD\u6307\u6807\u76D1\u63A7</h3><h4 id="\u529F\u80FD\u6982\u8FF0-1" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u6982\u8FF0-1" aria-hidden="true">#</a> \u529F\u80FD\u6982\u8FF0</h4><ul><li><strong>\u9996\u6B21\u7ED8\u5236\uFF08First Paint, FP\uFF09\u548C\u9996\u6B21\u5185\u5BB9\u7ED8\u5236\uFF08First Contentful Paint, FCP\uFF09\u76D1\u63A7</strong>\uFF1A \u901A\u8FC7 <code>PerformanceObserver</code> \u76D1\u63A7\u9875\u9762\u7684\u9996\u6B21\u7ED8\u5236\u548C\u9996\u6B21\u5185\u5BB9\u7ED8\u5236\u65F6\u95F4\uFF0C\u5E76\u5728\u9875\u9762\u52A0\u8F7D\u5B8C\u6210\u540E\u5C06\u8FD9\u4E9B\u6307\u6807\u4E0A\u62A5\uFF0C\u4EE5\u8861\u91CF\u9875\u9762\u7684\u521D\u59CB\u6E32\u67D3\u6027\u80FD\u3002</li><li><strong>\u6700\u5927\u5185\u5BB9\u7ED8\u5236\uFF08Largest Contentful Paint, LCP\uFF09\u76D1\u63A7</strong>\uFF1A \u901A\u8FC7 <code>PerformanceObserver</code> \u76D1\u63A7\u9875\u9762\u4E2D\u7684\u6700\u5927\u5185\u5BB9\u5143\u7D20\u7684\u52A0\u8F7D\u65F6\u95F4\uFF08\u5982\u5927\u56FE\u7247\u6216\u89C6\u9891\uFF09\uFF0C\u5E76\u4E0A\u62A5\u8BE5\u6307\u6807\uFF0C\u4EE5\u53CD\u6620\u9875\u9762\u4E2D\u4E3B\u8981\u5185\u5BB9\u7684\u52A0\u8F7D\u901F\u5EA6\u3002</li><li><strong>\u9996\u6B21\u8F93\u5165\u5EF6\u8FDF\uFF08First Input Delay, FID\uFF09\u76D1\u63A7</strong>\uFF1A\u901A\u8FC7 <code>PerformanceObserver</code> \u76D1\u63A7\u7528\u6237\u5728\u9875\u9762\u4E0A\u7684\u9996\u6B21\u4EA4\u4E92\uFF08\u5982\u70B9\u51FB\u6216\u8F93\u5165\uFF09\u7684\u54CD\u5E94\u5EF6\u8FDF\uFF0C \u8BB0\u5F55\u4ECE\u7528\u6237\u64CD\u4F5C\u5230\u6D4F\u89C8\u5668\u5F00\u59CB\u5904\u7406\u4E4B\u95F4\u7684\u5EF6\u8FDF\u65F6\u95F4\uFF0C\u4EE5\u53CA\u5904\u7406\u64CD\u4F5C\u7684\u8017\u65F6\u3002\u4EA4\u4E92\u6027\u95EE\u9898\u53CD\u9988\u3002</li><li><strong>\u9996\u6B21\u6709\u610F\u4E49\u7684\u7ED8\u5236\uFF08First Meaningful Paint, FMP\uFF09\u76D1\u63A7</strong>\uFF1A\u76D1\u63A7\u9875\u9762\u4E2D\u6709\u610F\u4E49\u7684\u5143\u7D20\u7684\u7ED8\u5236\u65F6\u95F4\uFF0C\u786E\u4FDD\u9875\u9762\u7684\u5173\u952E\u5185\u5BB9\u5C3D\u5FEB\u5448\u73B0\u7ED9\u7528\u6237\u3002</li><li><strong>\u52A0\u8F7D\u65F6\u95F4\u6307\u6807\u4E0A\u62A5</strong>\uFF1A\u5728\u9875\u9762\u5B8C\u5168\u52A0\u8F7D\u540E\uFF0C\u901A\u8FC7 <code>window.performance.timing</code> \u83B7\u53D6\u9875\u9762\u5404\u9636\u6BB5\u7684\u52A0\u8F7D\u65F6\u95F4\uFF0C\u5305\u62ECTCP\u8FDE\u63A5\u65F6\u95F4\u3001\u9996\u5B57\u8282\u5230\u8FBE\u65F6\u95F4\uFF08TTFB\uFF09\u3001 \u54CD\u5E94\u65F6\u95F4\u3001DOM\u89E3\u6790\u65F6\u95F4\u3001<code>DOMContentLoaded</code> \u4E8B\u4EF6\u65F6\u95F4\u3001\u9996\u6B21\u53EF\u4EA4\u4E92\u65F6\u95F4\uFF08TTI\uFF09\u548C\u5B8C\u6574\u52A0\u8F7D\u65F6\u95F4\u7B49\u3002</li><li><strong>\u5EF6\u8FDF\u4E0A\u62A5</strong>\uFF1A\u4F7F\u7528 onload \u51FD\u6570\u786E\u4FDD\u9875\u9762\u5185\u5BB9\u5B8C\u5168\u52A0\u8F7D\u540E\uFF0C\u518D\u5EF6\u8FDF3\u79D2\u4E0A\u62A5\u5404\u7C7B\u6027\u80FD\u6570\u636E\uFF0C\u4EE5\u907F\u514D\u5728\u9875\u9762\u521D\u59CB\u52A0\u8F7D\u8FC7\u7A0B\u4E2D\u589E\u52A0\u4E0D\u5FC5\u8981\u7684\u6027\u80FD\u5F00\u9500\u3002</li></ul><h4 id="\u6280\u672F\u5B9E\u73B0-6" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0-6" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span>lazyReport<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils/report&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> onload <span class="token keyword">from</span> <span class="token string">&quot;../utils/onload&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> formatTime <span class="token keyword">from</span> <span class="token string">&quot;../utils/formatTime&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getLastEvent <span class="token keyword">from</span> <span class="token string">&quot;../utils/getLastEvent&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getSelector <span class="token keyword">from</span> <span class="token string">&quot;../utils/getSelector&quot;</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * \u52A0\u8F7D\u65F6\u95F4\u548C\u6027\u80FD\u6307\u6807\u76D1\u63A7
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">timing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token constant">FMP</span><span class="token punctuation">,</span> <span class="token constant">LCP</span><span class="token punctuation">;</span>
    <span class="token comment">// \u589E\u52A0\u4E00\u4E2A\u6027\u80FD\u6761\u76EE\u7684\u89C2\u5BDF\u8005</span>
    <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryList<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> perfEntries <span class="token operator">=</span> entryList<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">FMP</span> <span class="token operator">=</span> perfEntries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u518D\u89C2\u5BDF\u4E86</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;element&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u89C2\u5BDF\u9875\u9762\u4E2D\u6709\u610F\u4E49\u7684\u5143\u7D20</span>
    <span class="token comment">// \u589E\u52A0\u4E00\u4E2A\u6027\u80FD\u6761\u76EE\u7684\u89C2\u5BDF\u8005</span>
    <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryList<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> perfEntries <span class="token operator">=</span> entryList<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> lastEntry <span class="token operator">=</span> perfEntries<span class="token punctuation">[</span>perfEntries<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token constant">LCP</span> <span class="token operator">=</span> lastEntry<span class="token punctuation">;</span>
        observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u518D\u89C2\u5BDF\u4E86</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;largest-contentful-paint&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u89C2\u5BDF\u9875\u9762\u4E2D\u6700\u5927\u7684\u5143\u7D20</span>
    <span class="token comment">// \u589E\u52A0\u4E00\u4E2A\u6027\u80FD\u6761\u76EE\u7684\u89C2\u5BDF\u8005</span>
    <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryList<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> firstInput <span class="token operator">=</span> entryList<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstInput<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5F00\u59CB\u5904\u7406\u7684\u65F6\u95F4 - \u5F00\u59CB\u70B9\u51FB\u7684\u65F6\u95F4\uFF0C\u5DEE\u503C\u5C31\u662F\u5904\u7406\u7684\u5EF6\u8FDF</span>
            <span class="token keyword">let</span> inputDelay <span class="token operator">=</span> firstInput<span class="token punctuation">.</span>processingStart <span class="token operator">-</span> firstInput<span class="token punctuation">.</span>startTime<span class="token punctuation">;</span>
            <span class="token keyword">let</span> duration <span class="token operator">=</span> firstInput<span class="token punctuation">.</span>duration<span class="token punctuation">;</span> <span class="token comment">// \u5904\u7406\u7684\u8017\u65F6</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>inputDelay <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> duration <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u9996\u6B21\u8F93\u5165\u5EF6\u8FDF</span>
                <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;firstInputDelay&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;experience&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237\u4F53\u9A8C\u6307\u6807</span>
                    <span class="token literal-property property">inputDelay</span><span class="token operator">:</span> inputDelay <span class="token operator">?</span> <span class="token function">formatTime</span><span class="token punctuation">(</span>inputDelay<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u5EF6\u8FDF\u7684\u65F6\u95F4</span>
                    <span class="token literal-property property">duration</span><span class="token operator">:</span> duration <span class="token operator">?</span> <span class="token function">formatTime</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u5904\u7406\u7684\u8017\u65F6</span>
                    <span class="token literal-property property">startTime</span><span class="token operator">:</span> firstInput<span class="token punctuation">.</span>startTime<span class="token punctuation">,</span> <span class="token comment">// \u5F00\u59CB\u5904\u7406\u7684\u65F6\u95F4</span>
                    <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent
                        <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path <span class="token operator">||</span> lastEvent<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
                        <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4E0D\u518D\u89C2\u5BDF\u4E86</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;first-input&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u7B2C\u4E00\u6B21\u4EA4\u4E92</span>

    <span class="token comment">// \u521A\u5F00\u59CB\u9875\u9762\u5185\u5BB9\u4E3A\u7A7A\uFF0C\u7B49\u9875\u9762\u6E32\u67D3\u5B8C\u6210\uFF0C\u518D\u53BB\u505A\u5224\u65AD</span>
    <span class="token function">onload</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span>
                fetchStart<span class="token punctuation">,</span>
                connectStart<span class="token punctuation">,</span>
                connectEnd<span class="token punctuation">,</span>
                requestStart<span class="token punctuation">,</span>
                responseStart<span class="token punctuation">,</span>
                responseEnd<span class="token punctuation">,</span>
                domLoading<span class="token punctuation">,</span>
                domInteractive<span class="token punctuation">,</span>
                domContentLoadedEventStart<span class="token punctuation">,</span>
                domContentLoadedEventEnd<span class="token punctuation">,</span>
                loadEventStart<span class="token punctuation">,</span>
            <span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span>timing<span class="token punctuation">;</span>
            <span class="token comment">// \u53D1\u9001\u65F6\u95F4\u6307\u6807  \u7EDF\u8BA1\u6BCF\u4E2A\u9636\u6BB5\u7684\u65F6\u95F4</span>
            <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;timing&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;experience&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237\u4F53\u9A8C\u6307\u6807</span>
                <span class="token literal-property property">connectTime</span><span class="token operator">:</span> connectEnd <span class="token operator">-</span> connectStart<span class="token punctuation">,</span> <span class="token comment">// TCP\u8FDE\u63A5\u8017\u65F6</span>
                <span class="token literal-property property">ttfbTime</span><span class="token operator">:</span> responseStart <span class="token operator">-</span> requestStart<span class="token punctuation">,</span> <span class="token comment">// \u9996\u5B57\u8282\u5230\u8FBE\u65F6\u95F4</span>
                <span class="token literal-property property">responseTime</span><span class="token operator">:</span> responseEnd <span class="token operator">-</span> responseStart<span class="token punctuation">,</span> <span class="token comment">// response\u54CD\u5E94\u8017\u65F6</span>
                <span class="token literal-property property">parseDOMTime</span><span class="token operator">:</span> loadEventStart <span class="token operator">-</span> domLoading<span class="token punctuation">,</span> <span class="token comment">// DOM\u89E3\u6790\u6E32\u67D3\u7684\u65F6\u95F4</span>
                <span class="token literal-property property">domContentLoadedTime</span><span class="token operator">:</span> domContentLoadedEventEnd <span class="token operator">-</span> domContentLoadedEventStart<span class="token punctuation">,</span> <span class="token comment">// DOMContentLoaded\u4E8B\u4EF6\u56DE\u8C03\u8017\u65F6</span>
                <span class="token literal-property property">timeToInteractive</span><span class="token operator">:</span> domInteractive <span class="token operator">-</span> fetchStart<span class="token punctuation">,</span> <span class="token comment">// \u9996\u6B21\u53EF\u4EA4\u4E92\u65F6\u95F4</span>
                <span class="token literal-property property">loadTime</span><span class="token operator">:</span> loadEventStart <span class="token operator">-</span> fetchStart<span class="token punctuation">,</span> <span class="token comment">// \u5B8C\u6574\u7684\u52A0\u8F7D\u65F6\u95F4</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u53D1\u9001\u6027\u80FD\u6307\u6807</span>
            <span class="token keyword">let</span> <span class="token constant">FP</span> <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByName</span><span class="token punctuation">(</span><span class="token string">&quot;first-paint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> <span class="token constant">FCP</span> <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByName</span><span class="token punctuation">(</span><span class="token string">&quot;first-contentful-paint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;paint&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;experience&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237\u4F53\u9A8C\u6307\u6807</span>
                <span class="token literal-property property">firstPaint</span><span class="token operator">:</span> <span class="token constant">FP</span> <span class="token operator">?</span> <span class="token function">formatTime</span><span class="token punctuation">(</span><span class="token constant">FP</span><span class="token punctuation">.</span>startTime<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// \u9996\u6B21\u7ED8\u5236\u65F6\u95F4</span>
                <span class="token literal-property property">firstContentPaint</span><span class="token operator">:</span> <span class="token constant">FCP</span> <span class="token operator">?</span> <span class="token function">formatTime</span><span class="token punctuation">(</span><span class="token constant">FCP</span><span class="token punctuation">.</span>startTime<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u9996\u6B21\u5185\u5BB9\u7ED8\u5236\u65F6\u95F4</span>
                <span class="token literal-property property">firstMeaningfulPaint</span><span class="token operator">:</span> <span class="token constant">FMP</span> <span class="token operator">?</span> <span class="token function">formatTime</span><span class="token punctuation">(</span><span class="token constant">FMP</span><span class="token punctuation">.</span>startTime<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u9996\u6B21\u6709\u610F\u4E49\u7ED8\u5236\u65F6\u95F4</span>
                <span class="token literal-property property">largestContentfulPaint</span><span class="token operator">:</span> <span class="token constant">LCP</span>
                    <span class="token operator">?</span> <span class="token function">formatTime</span><span class="token punctuation">(</span><span class="token constant">LCP</span><span class="token punctuation">.</span>renderTime <span class="token operator">||</span> <span class="token constant">LCP</span><span class="token punctuation">.</span>loadTime<span class="token punctuation">)</span>
                    <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u6700\u5927\u5185\u5BB9\u7ED8\u5236\u65F6\u95F4</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u57CB\u70B9\u4E0A\u62A5-1" tabindex="-1"><a class="header-anchor" href="#\u57CB\u70B9\u4E0A\u62A5-1" aria-hidden="true">#</a> \u57CB\u70B9\u4E0A\u62A5</h3><h4 id="\u529F\u80FD\u6982\u8FF0-2" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u6982\u8FF0-2" aria-hidden="true">#</a> \u529F\u80FD\u6982\u8FF0</h4><ul><li><strong>\u624B\u52A8\u57CB\u70B9\u4E0A\u62A5</strong>\uFF1A\u901A\u8FC7 actionTracker \u51FD\u6570\uFF0C\u63A5\u6536 actionType\uFF08\u884C\u4E3A\u7C7B\u578B\uFF09\u548C data\uFF08\u76F8\u5173\u6570\u636E\uFF09\u4E24\u4E2A\u53C2\u6570\uFF0C\u624B\u52A8\u89E6\u53D1\u884C\u4E3A\u57CB\u70B9\u4E0A\u62A5\u3002</li><li><strong>\u81EA\u52A8\u57CB\u70B9\u4E0A\u62A5</strong>\uFF1A\u4E3B\u8981\u7528\u4E8E\u81EA\u52A8\u6355\u83B7\u7528\u6237\u5728\u9875\u9762\u4E0A\u7684\u70B9\u51FB\u64CD\u4F5C\u3002\u76D1\u542C document.body \u7684 click \u4E8B\u4EF6\uFF0C\u6BCF\u5F53\u7528\u6237\u70B9\u51FB\u9875\u9762\u4E2D\u7684\u67D0\u4E2A\u5143\u7D20\u65F6\uFF0C\u81EA\u52A8\u89E6\u53D1\u57CB\u70B9\u4E0A\u62A5\u3002 \u5982\u679C\u70B9\u51FB\u7684\u5143\u7D20\u5305\u542B data-target \u5C5E\u6027\uFF0C\u5219\u4E0A\u62A5\u8BE5\u5C5E\u6027\u503C\u4F5C\u4E3A\u57CB\u70B9\u6570\u636E\uFF0C\u8868\u660E\u8FD9\u662F\u4E00\u4E2A\u6709\u660E\u786E\u76EE\u6807\u7684\u57CB\u70B9\u3002 \u5982\u679C\u5143\u7D20\u672A\u8BBE\u7F6E data-target \u5C5E\u6027\uFF0C\u81EA\u52A8\u83B7\u53D6\u88AB\u70B9\u51FB\u5143\u7D20\u7684 DOM \u8DEF\u5F84\uFF0C\u5E76\u4E0A\u62A5\u4F5C\u4E3A\u57CB\u70B9\u6570\u636E\uFF0C\u8BB0\u5F55\u7528\u6237\u70B9\u51FB\u4E86\u54EA\u4E2A\u9875\u9762\u5143\u7D20\u3002</li></ul><h4 id="\u6280\u672F\u5B9E\u73B0-7" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0-7" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>

<span class="token keyword">import</span> <span class="token punctuation">{</span> lazyReport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/report&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getPathTo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/util&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getLastEvent <span class="token keyword">from</span> <span class="token string">&#39;../utils/getLastEvent&#39;</span>
<span class="token keyword">import</span> getSelector <span class="token keyword">from</span> <span class="token string">&quot;../utils/getSelector&quot;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u624B\u52A8\u57CB\u70B9\u4E0A\u62A5
 * type \u884C\u4E3A\u57CB\u70B9
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">actionTracker</span><span class="token punctuation">(</span><span class="token parameter">actionType<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;action&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;tracker&#39;</span><span class="token punctuation">,</span>
        actionType<span class="token punctuation">,</span>
        data
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * \u81EA\u52A8\u57CB\u70B9\u4E0A\u62A5
 * type \u884C\u4E3A\u57CB\u70B9
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">autoTracker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u81EA\u52A8\u4E0A\u62A5</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> clickedDom <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
        <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6355\u83B7\u6700\u540E\u4E00\u4E2A\u4EA4\u4E92\u4E8B\u4EF6\uFF08\u6700\u65B0\u6807\u51C6pointerEvent\u65E0\u6CD5\u83B7\u53D6path)</span>

        <span class="token comment">// \u83B7\u53D6\u6807\u7B7E\u4E0A\u7684data-target\u5C5E\u6027\u7684\u503C</span>
        <span class="token keyword">let</span> target <span class="token operator">=</span> clickedDom<span class="token operator">?.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-target&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u83B7\u53D6\u6807\u7B7E\u4E0A\u7684data-no\u5C5E\u6027\u7684\u503C</span>
        <span class="token keyword">let</span> no <span class="token operator">=</span> clickedDom<span class="token operator">?.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-no&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u907F\u514D\u91CD\u590D\u4E0A\u62A5</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>no<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u5168\u5C40\u57CB\u70B9</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;action&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;tracker&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">actionType</span><span class="token operator">:</span> <span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> target<span class="token punctuation">,</span> <span class="token comment">// \u624B\u52A8\u6DFB\u52A0data-target\u5C5E\u6027\u83B7\u53D6\u5C5E\u6027\u503C</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5168\u5C40\u57CB\u70B9 \u83B7\u53D6\u88AB\u70B9\u51FB\u5143\u7D20\u7684dom\u8DEF\u5F84</span>
            <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">getPathTo</span><span class="token punctuation">(</span>clickedDom<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;action&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;tracker&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">actionType</span><span class="token operator">:</span> <span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">// \u4EE3\u8868\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u5143\u7D20</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> path
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6570\u636E\u4E0A\u62A5-1" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u4E0A\u62A5-1" aria-hidden="true">#</a> \u6570\u636E\u4E0A\u62A5</h3><h4 id="\u529F\u80FD\u6982\u8FF0-3" tabindex="-1"><a class="header-anchor" href="#\u529F\u80FD\u6982\u8FF0-3" aria-hidden="true">#</a> \u529F\u80FD\u6982\u8FF0</h4><ul><li>xhr\u8BF7\u6C42\u63A5\u53E3\u4E0A\u62A5\uFF08\u5982\u670D\u52A1\u5668\u4E0D\u540C\u9700\u8DE8\u57DF\uFF0C\u5237\u65B0\u91CD\u65B0\u6253\u5F00\u53EF\u80FD\u4E22\u5931\u6570\u636E\uFF09</li><li>img\u6807\u7B7E\u4E0A\u62A5\uFF08\u907F\u514D\u4E86\u8DE8\u57DF\u95EE\u9898\uFF0C\u4F46\u4E0D\u9002\u5408\u5927\u91CF\u6570\u636E\u4E0A\u62A5\uFF0Curl\u957F\u5EA6\u9650\u5236\uFF09</li><li>sendBeacon\uFF08\u65E0\u9700\u8DE8\u57DF\uFF0C\u4E0D\u4F1A\u5237\u65B0\u4E22\u5931\u6570\u636E\uFF0C\u6709\u517C\u5BB9\u95EE\u9898\uFF09</li><li>sendBeacon\u4E0A\u62A5\u548Cimg\u6807\u7B7E\u4E0A\u62A5\u7ED3\u5408\u7684\u65B9\u5F0F\uFF1B</li><li>\u6CE8\uFF1A\u4EE5\u4E0A\u56DB\u79CD\u4E0A\u62A5\u65B9\u5F0F\u914D\u7F6E\u53EF\u9009\uFF0C\u63A8\u8350\u6700\u540E\u4E00\u79CD\u65B9\u5F0F\u3002</li></ul><h4 id="sendbeacon-\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#sendbeacon-\u4ECB\u7ECD" aria-hidden="true">#</a> sendBeacon \u4ECB\u7ECD\uFF1A</h4><p>\u7528\u4E8E\u5728\u9875\u9762\u5378\u8F7D\u6216\u5173\u95ED\u65F6\uFF0C\u5C06\u5C11\u91CF\u7684\u6570\u636E\u5F02\u6B65\u53D1\u9001\u5230\u670D\u52A1\u5668\u3002\u5B83\u4E3B\u8981\u7528\u4E8E\u5728\u7528\u6237\u79BB\u5F00\u9875\u9762\u65F6\u4F20\u9012\u4E00\u4E9B\u5206\u6790\u6570\u636E\u6216\u65E5\u5FD7\uFF0C\u800C\u4E0D\u4F1A\u5F71\u54CD\u9875\u9762\u7684\u6027\u80FD\u6216\u7528\u6237\u4F53\u9A8C\u3002</p><ol><li><strong>\u5F02\u6B65\u4F20\u8F93</strong>\uFF1A\u4E0E\u5176\u4ED6\u7684 AJAX \u8BF7\u6C42\u4E0D\u540C\uFF0CsendBeacon \u662F\u5F02\u6B65\u7684\uFF0C\u4E0D\u4F1A\u963B\u585E\u9875\u9762\u7684\u5378\u8F7D\u64CD\u4F5C\u6216\u7528\u6237\u7684\u4E0B\u4E00\u6B65\u4EA4\u4E92\u3002</li><li><strong>\u5728\u9875\u9762\u5173\u95ED\u65F6\u53D1\u9001</strong>\uFF1A\u5B83\u975E\u5E38\u9002\u5408\u5728\u9875\u9762\u5173\u95ED\u6216\u5373\u5C06\u5173\u95ED\uFF08\u5982\u9875\u9762\u5237\u65B0\u3001\u5BFC\u822A\u79BB\u5F00\u9875\u9762\u7B49\uFF09\u65F6\u53D1\u9001\u6570\u636E\u3002\u4F20\u7EDF\u7684 AJAX \u8BF7\u6C42\u5728\u8FD9\u4E9B\u573A\u666F\u4E0B\u53EF\u80FD\u65E0\u6CD5\u4FDD\u8BC1\u6570\u636E\u4F20\u8F93\u7684\u6210\u529F\uFF0C \u56E0\u4E3A\u9875\u9762\u5173\u95ED\u53EF\u80FD\u4F1A\u4E2D\u65AD\u8BF7\u6C42\u3002\u800C sendBeacon \u4FDD\u8BC1\u6570\u636E\u80FD\u591F\u5728\u9875\u9762\u5173\u95ED\u4E4B\u524D\u5C3D\u53EF\u80FD\u5730\u53D1\u9001\u3002</li><li><strong>\u4F4E\u5F00\u9500\u7684\u4F20\u8F93</strong>\uFF1AsendBeacon \u7684\u8BBE\u8BA1\u662F\u4E3A\u4E86\u5C3D\u91CF\u51CF\u5C11\u5BF9\u8D44\u6E90\u7684\u5360\u7528\uFF0C\u9002\u5408\u4F20\u8F93\u5C0F\u91CF\u6570\u636E\uFF0C\u5C24\u5176\u662F\u5206\u6790\u6570\u636E\u3001\u4E8B\u4EF6\u8DDF\u8E2A\u3001\u7EDF\u8BA1\u4FE1\u606F\u7B49\u3002</li><li><strong>POST \u8BF7\u6C42</strong>\uFF1AsendBeacon \u53D1\u9001\u7684\u662F HTTP POST \u8BF7\u6C42\uFF0C\u53D1\u9001\u7684\u6570\u636E\u683C\u5F0F\u53EF\u4EE5\u662F\u5B57\u7B26\u4E32\u3001FormData \u6216 Blob\u3002</li></ol><h4 id="\u6280\u672F\u5B9E\u73B0-8" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u5B9E\u73B0-8" aria-hidden="true">#</a> \u6280\u672F\u5B9E\u73B0</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCache<span class="token punctuation">,</span> addCache<span class="token punctuation">,</span> clearCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./cache&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * \u4E0A\u62A5\u6570\u636E\u5904\u7406
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">type</span> \u4E0A\u5831\u985E\u578B
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">params</span> \u4E0A\u5831\u4FE1\u606F
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">lazyReport</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> appId <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_app_id_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> userId <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_user_id_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> delay <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_delay_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u516C\u5171\u4E0A\u62A5\u53C2\u6570
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token punctuation">{</span>appId<span class="token punctuation">,</span> userAgent<span class="token operator">:</span> string<span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token operator">*</span><span class="token punctuation">,</span> title<span class="token operator">:</span> string<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> url<span class="token operator">:</span> string<span class="token punctuation">,</span> timestamp<span class="token operator">:</span> number<span class="token punctuation">}</span><span class="token punctuation">}</span></span>
     */</span>
    <span class="token keyword">function</span> <span class="token function">getExtraData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            appId<span class="token punctuation">,</span> <span class="token comment">// \u9879\u76EE\u7684appId</span>
            userId<span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237id</span>
            type<span class="token punctuation">,</span> <span class="token comment">// error/action/visit/user</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> document<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token comment">// \u5F53\u524D\u9875title</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span> <span class="token comment">// \u5F53\u524D\u9875url</span>
            <span class="token literal-property property">timestamp</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// \u65F6\u95F4\u6233</span>
            <span class="token literal-property property">userAgent</span><span class="token operator">:</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span> <span class="token comment">// \u6D4F\u89C8\u5668\u4FE1\u606F</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> extraData <span class="token operator">=</span> <span class="token function">getExtraData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> logParams <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>extraData<span class="token punctuation">,</span> <span class="token comment">// \u516C\u5171\u4FE1\u606F</span>
        <span class="token operator">...</span>params<span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u7684\u6570\u636E</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// \u786E\u4FDD\u6570\u636E\u683C\u5F0F\u7EDF\u4E00</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> logParams<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> logParams<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;number&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            logParams<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>logParams<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">addCache</span><span class="token punctuation">(</span>logParams<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u7ACB\u5373\u4E0A\u62A5</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// delay=0\u76F8\u5F53\u4E8E\u4E0D\u505A\u5EF6\u8FDF\u4E0A\u62A5</span>
        <span class="token function">report</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u9608\u503C\u4E0A\u62A5\uFF08\u907F\u514D\u5355\u6B21\u4E0A\u62A5\u6570\u636E\u8FC7\u957F\uFF09</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">report</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u9632\u6296\u5EF6\u8FDF\u4E0A\u62A5</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">report</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * \u4E0A\u62A5\u6570\u636E
 * <span class="token keyword">@param</span> <span class="token parameter">data</span>
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">report</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_url_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> urlImg <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_url_img_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> reportType <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_type_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>reportType <span class="token operator">===</span> <span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// ------- img\u65B9\u5F0F\u4E0A\u62A5 -------</span>
        <span class="token keyword">let</span> oImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        oImage<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>urlImg <span class="token operator">||</span> url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?logs=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>reportType <span class="token operator">===</span> <span class="token string">&#39;sendBeacon&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// ------- navigator.sendBeacon\u4E0A\u62A5 -------</span>
        navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">logs</span><span class="token operator">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>reportType <span class="token operator">===</span> <span class="token string">&#39;imgSendBeacon&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// ------- \u9ED8\u8BA4\uFF1Anavigator/img\u65B9\u5F0F\u4E0A\u62A5 -------</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>sendBeacon<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u652F\u6301sendBeacon\u7684\u6D4F\u89C8\u5668</span>
            navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">logs</span><span class="token operator">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// \u4E0D\u652F\u6301sendBeacon\u7684\u6D4F\u89C8\u5668</span>
            <span class="token keyword">let</span> oImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            oImage<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>urlImg <span class="token operator">||</span> url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?logs=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>reportType <span class="token operator">===</span> <span class="token string">&#39;fetch&#39;</span> <span class="token operator">||</span> <span class="token operator">!</span>reportType<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// ------- fetch\u65B9\u5F0F\u4E0A\u62A5 -------</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">logs</span><span class="token operator">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5DE5\u5177\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u5DE5\u5177\u7C7B" aria-hidden="true">#</a> \u5DE5\u5177\u7C7B</h3><h4 id="\u52A0\u8F7D\u914D\u7F6E-\u548C-\u83B7\u53D6\u5143\u7D20\u7684dom\u8DEF\u5F84" tabindex="-1"><a class="header-anchor" href="#\u52A0\u8F7D\u914D\u7F6E-\u548C-\u83B7\u53D6\u5143\u7D20\u7684dom\u8DEF\u5F84" aria-hidden="true">#</a> \u52A0\u8F7D\u914D\u7F6E \u548C \u83B7\u53D6\u5143\u7D20\u7684dom\u8DEF\u5F84</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> autoTracker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../lib/actionTracker&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> hashPageTracker<span class="token punctuation">,</span> historyPageTracker<span class="token punctuation">,</span> pv <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../lib/pageTracker&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectJsError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../lib/jsError&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectXHR <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">&#39;../lib/xhr&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../lib/fetch&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> blankScreen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../lib/blankScreen&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> timing <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../lib/timing&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> longTask <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../lib/longTask&quot;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u52A0\u8F7D\u914D\u7F6E
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">options</span>
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">loadConfig</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
        appId<span class="token punctuation">,</span>  <span class="token comment">// \u7CFB\u7EDFid</span>
        userId<span class="token punctuation">,</span> <span class="token comment">// \u7528\u6237id</span>
        reportUrl<span class="token punctuation">,</span> <span class="token comment">// \u670D\u52A1\u7AEF\u4E0A\u62A5\u5730\u5740</span>
        reportUrlImg<span class="token punctuation">,</span> <span class="token comment">// \u5982\u4F55\u91C7\u7528\u4E86\u4E24\u79CD\u65B9\u5F0F\u5408\u5E76\uFF0C\u9700\u591A\u4E32\u4E00\u4E2Aimg\u4E0A\u4F20\u5730\u5740\uFF0C\u63A8\u83501*1px git\u56FE\u7247</span>
        reportType<span class="token punctuation">,</span> <span class="token comment">// \u4E0A\u62A5\u65B9\u5F0F fetch(\u9ED8\u8BA4)\uFF0Cimg\uFF0CsendBeacon, imgSendBeacon(\u4E24\u79CD\u65B9\u5F0F\u5408\u5E76\uFF09</span>
        xhrType<span class="token punctuation">,</span> <span class="token comment">// xhr\u76D1\u63A7\u7C7B\u578B all,load,abort,error ; \u9ED8\u8BA4\u53EA\u76D1\u63A7 error</span>
        routerType<span class="token punctuation">,</span> <span class="token comment">// \u8DEF\u7531\u7C7B\u578B hash \u6216 history  \u9ED8\u8BA4hash</span>
        delay<span class="token punctuation">,</span> <span class="token comment">// \u5EF6\u8FDF\u548C\u5408\u5E76\u4E0A\u62A5\u7684\u529F\u80FD</span>
        autoTrackerReport<span class="token punctuation">,</span> <span class="token comment">// \u81EA\u52A8\u57CB\u70B9\u662F\u5426\u5F00\u542F</span>
        stabilityReport<span class="token punctuation">,</span> <span class="token comment">// \u662F\u5426\u5F00\u542F\u7A33\u5B9A\u6027\u76D1\u63A7\uFF08js,promise,\u8D44\u6E90\u52A0\u8F7D\uFF0C\u63A5\u53E3\uFF0C\u767D\u5C4F\uFF09</span>
        isHideResourceError<span class="token punctuation">,</span> <span class="token comment">// \u662F\u5426\u5173\u95ED\u8D44\u6E90\u9519\u8BEF\u4E0A\u62A5 \u9ED8\u8BA4 false</span>
        pageTrackerReport<span class="token punctuation">,</span> <span class="token comment">// \u662F\u5426\u5F00\u542F\u7528\u6237\u505C\u7559\u53CApv\u4E0A\u62A5</span>
        timingReport<span class="token punctuation">,</span> <span class="token comment">// \u662F\u5426\u5F00\u542F\u6027\u80FD\u6307\u6807\u76D1\u63A7</span>
        longTaskReport<span class="token punctuation">,</span> <span class="token comment">// \u662F\u5426\u5F00\u542F\u957F\u4EFB\u52A1\u76D1\u63A7(\u5361\u987F)</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>

    <span class="token comment">// --------- appId ----------------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>appId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_app_id_&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> appId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------- userId ----------------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_user_id_&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> userId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------- \u670D\u52A1\u7AEF\u5730\u5740 ----------------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reportUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_url_&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> reportUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------- \u670D\u52A1\u7AEF\u5730\u5740 ----------------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reportUrlImg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_url_img_&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> reportUrlImg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// -------- \u5408\u5E76\u4E0A\u62A5\u7684\u95F4\u9694 ------------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_delay_&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> delay<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// -------- \u4E0A\u62A5\u65B9\u5F0F ------------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reportType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_type_&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> reportType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// -------- xhr\u76D1\u63A7\u7C7B\u578B ------------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhrType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_xhr_type_&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> xhrType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------- \u662F\u5426\u5F00\u542F\u7A33\u5B9A\u6027\u76D1\u63A7 ------------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isHideResourceError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u662F\u5426\u9690\u85CF\u8D44\u6E90\u9519\u8BEF\u4E0A\u62A5</span>
        window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_is_hide_resource_error_&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> isHideResourceError<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stabilityReport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">injectJsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">injectXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">injectFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">blankScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------- \u662F\u5426\u5F00\u542F\u65E0\u75D5\u57CB\u70B9 ----------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>autoTrackerReport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">autoTracker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------- \u662F\u5426\u5F00\u542F\u52A0\u8F7D\u65F6\u95F4\u548C\u6027\u80FD\u6307\u6807\u76D1\u63A7 ----------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timingReport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">timing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------- \u662F\u5426\u5F00\u542F\u957F\u4EFB\u52A1\u76D1\u63A7(\u5361\u987F) ----------</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>longTaskReport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">longTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// ----------- \u7528\u6237\u505C\u7559\u65F6\u95F4\uFF0Cuv, pv\u8BBF\u95EE\u4E0A\u62A5 --------------</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pageTrackerReport<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>routerType <span class="token operator">===</span> <span class="token string">&#39;history&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">historyPageTracker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// history\u8DEF\u7531\u4E0A\u62A5</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">hashPageTracker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hash\u8DEF\u7531\u4E0A\u62A5</span>
        <span class="token punctuation">}</span>
        <span class="token function">pv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pv \u548C \u603B\u505C\u7559\u65F6\u95F4</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * \u83B7\u53D6\u5143\u7D20\u7684dom\u8DEF\u5F84
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">element</span>
 * <span class="token keyword">@returns</span> *[@id=&quot;root&quot;]/DIV[1]/DIV[2]/BUTTON[1]
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getPathTo</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>id <span class="token operator">!==</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">&#39;//*[@id=&quot;&#39;</span> <span class="token operator">+</span> element<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&#39;&quot;]&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">===</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
        <span class="token keyword">return</span> element<span class="token punctuation">.</span>tagName<span class="token punctuation">;</span>

    <span class="token keyword">let</span> ix<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> siblings <span class="token operator">=</span> element<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> siblings<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> sibling <span class="token operator">=</span> siblings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sibling <span class="token operator">===</span> element<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token function">getPathTo</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>parentNode<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> element<span class="token punctuation">.</span>tagName <span class="token operator">+</span> <span class="token string">&#39;[&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ix <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;]&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sibling<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> sibling<span class="token punctuation">.</span>tagName <span class="token operator">===</span> element<span class="token punctuation">.</span>tagName<span class="token punctuation">)</span>
            ix <span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5EF6\u8FDF\u4E0A\u62A5\u7F13\u5B58" tabindex="-1"><a class="header-anchor" href="#\u5EF6\u8FDF\u4E0A\u62A5\u7F13\u5B58" aria-hidden="true">#</a> \u5EF6\u8FDF\u4E0A\u62A5\u7F13\u5B58</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token doc-comment comment">/**
 * \u5EF6\u8FDF\u4E0A\u62A5\u7F13\u5B58
 * <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
 */</span>
<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addCache</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u83B7\u53D6\u65F6\u95F4\u6233" tabindex="-1"><a class="header-anchor" href="#\u83B7\u53D6\u65F6\u95F4\u6233" aria-hidden="true">#</a> \u83B7\u53D6\u65F6\u95F4\u6233</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token doc-comment comment">/**
 * \u83B7\u53D6\u65F6\u95F4\u6233
 * <span class="token keyword">@param</span> <span class="token parameter">time</span> <span class="token punctuation">{</span>string<span class="token punctuation">}</span>
 * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span>
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> timestamp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u83B7\u53D6\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u4E8B\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u83B7\u53D6\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u4E8B\u4EF6" aria-hidden="true">#</a> \u83B7\u53D6\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u4E8B\u4EF6</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * \u83B7\u53D6\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C\u7684\u4E8B\u4EF6
 */</span>

<span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;touchstart&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mousedown&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;keydown&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mouseover&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">eventType</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        lastEvent <span class="token operator">=</span> event <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// html5\u4E4B\u524D\u4F7F\u7528mouseEvent.path\u7B49\u83B7\u53D6\u4E8B\u4EF6\u4F4D\u7F6E\uFF0C</span>
        <span class="token comment">// html5\u4E4B\u540E\u6240\u6709\u4E8B\u4EF6\u4F7F\u7528 PointerEven \u66FF\u4EE3\uFF0C\u53D6\u6D88path</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">capture</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u6355\u83B7\u9636\u6BB5\u6267\u884C \u9632\u6B62\u4E8B\u4EF6\u4E22\u5931</span>
        <span class="token literal-property property">passive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u9ED8\u8BA4\u4E0D\u963B\u6B62\u9ED8\u8BA4\u4E8B\u4EF6</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> lastEvent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u83B7\u53D6dom\u8DEF\u5F84" tabindex="-1"><a class="header-anchor" href="#\u83B7\u53D6dom\u8DEF\u5F84" aria-hidden="true">#</a> \u83B7\u53D6dom\u8DEF\u5F84</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * \u83B7\u53D6dom\u8DEF\u5F84
 * <span class="token keyword">@param</span> <span class="token parameter">path</span>
 * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span>
 */</span>
<span class="token keyword">function</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u53CD\u8F6C + \u8FC7\u6EE4 + \u6620\u5C04 + \u62FC\u63A5</span>
    <span class="token keyword">return</span> path
        <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> element <span class="token operator">!==</span> document <span class="token operator">&amp;&amp;</span> element <span class="token operator">!==</span> window<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>element<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>className <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> element<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>element<span class="token punctuation">.</span>className<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                selector <span class="token operator">=</span> element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> selector<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pathsOrTarget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
            pathsOrTarget <span class="token operator">=</span> pathsOrTarget<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u83B7\u53D6\u9875\u9762\u52A0\u8F7D\u5B8C\u6210\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#\u83B7\u53D6\u9875\u9762\u52A0\u8F7D\u5B8C\u6210\u72B6\u6001" aria-hidden="true">#</a> \u83B7\u53D6\u9875\u9762\u52A0\u8F7D\u5B8C\u6210\u72B6\u6001</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * onload \u6587\u6863\u52A0\u8F7D\u5B8C\u6210\u540E\u6267\u884C\u4E00\u4E2A\u56DE\u8C03\u51FD\u6570 \u67D4\u5219\u7B49load\u4E8B\u4EF6\u89E6\u53D1\u518D\u8C03\u7528
 * <span class="token keyword">@param</span> <span class="token parameter">callback</span>
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">&quot;complete&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5165\u53E3\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u5165\u53E3\u6587\u4EF6" aria-hidden="true">#</a> \u5165\u53E3\u6587\u4EF6</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span> loadConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./utils/util&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> actionTracker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./lib/actionTracker&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> errorCatcher <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./lib/jsError&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> report <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./utils/report&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./utils/cache&#39;</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * \u521D\u59CB\u5316\u914D\u7F6E
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">options</span>
 */</span>
<span class="token keyword">function</span> <span class="token function">initMonitor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ------- \u52A0\u8F7D\u914D\u7F6E\uFF08\u62FF\u5230\u914D\u7F6E\u4FE1\u606F\uFF0C\u6CE8\u5165\u76D1\u63A7\u4EE3\u7801\uFF09 ----------</span>
    <span class="token function">loadConfig</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ------ \u9632\u6B62\u5378\u8F7D\u65F6\u8FD8\u6709\u5269\u4F59\u7684\u57CB\u70B9\u6570\u636E\u6CA1\u53D1\u9001 ------</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;unload&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">report</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token punctuation">{</span>
    initMonitor<span class="token punctuation">,</span> <span class="token comment">// \u76D1\u63A7\u521D\u59CB\u5316</span>
    actionTracker<span class="token punctuation">,</span> <span class="token comment">// \u57CB\u70B9\u624B\u52A8\u4E0A\u62A5\u65B9\u6CD5</span>
    errorCatcher<span class="token punctuation">,</span> <span class="token comment">// \u624B\u52A8\u6355\u83B7\u9519\u8BEF\u65B9\u6CD5 try catch, \u5176\u4ED6\u56DE\u8C03\u5F02\u5E38\u7B49</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jest\u5355\u5143\u6D4B\u8BD5\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#jest\u5355\u5143\u6D4B\u8BD5\u6848\u4F8B" aria-hidden="true">#</a> jest\u5355\u5143\u6D4B\u8BD5\u6848\u4F8B</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> 
<span class="token keyword">import</span> onload <span class="token keyword">from</span> <span class="token string">&#39;../src/utils/onload&#39;</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;onload&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> originalDocument<span class="token punctuation">;</span>

    <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        originalDocument <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>document <span class="token punctuation">}</span><span class="token punctuation">;</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&#39;readyState&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;loading&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">&#39;addEventListener&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>addEventListener<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document <span class="token operator">=</span> originalDocument<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should call the callback immediately if document.readyState is &quot;complete&quot;&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> mockCallback <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>readyState <span class="token operator">=</span> <span class="token string">&#39;complete&#39;</span><span class="token punctuation">;</span>

        <span class="token function">onload</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">expect</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should add a &quot;load&quot; event listener if document.readyState is not &quot;complete&quot;&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> mockCallback <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">onload</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&#39;load&#39;</span><span class="token punctuation">,</span> mockCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u9879\u76EE\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u9879\u76EE\u914D\u7F6E\u6587\u4EF6</h3><h4 id="webpack-config-js" tabindex="-1"><a class="header-anchor" href="#webpack-config-js" aria-hidden="true">#</a> webpack.config.js</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;ddd-monitor-sdk.min.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&#39;dddMonitorSdk&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&#39;umd&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">environment</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">arrowFunction</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(node_modules|bower_components)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@babel/preset-env&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@babel/plugin-transform-arrow-functions&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;@babel/plugin-transform-modules-umd&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&#39;source-map&#39;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="babelrc" tabindex="-1"><a class="header-anchor" href="#babelrc" aria-hidden="true">#</a> .babelrc</h4><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>
<span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;chrome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;58&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;ie&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>&#39;@babel/plugin-transform-arrow-functions&#39;<span class="token punctuation">,</span> &#39;@babel/plugin-transform-modules-umd&#39;<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="package-json" tabindex="-1"><a class="header-anchor" href="#package-json" aria-hidden="true">#</a> package.json</h4><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ddd-monitor-sdk&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1.6&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u76D1\u63A7SDK svg\u767D\u5C4F\u517C\u5BB9&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/ddd-monitor-sdk.min.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;\u524D\u7AEF&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;\u524D\u7AEF\u76D1\u63A7&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Front-end&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;monitor&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;SDK&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ddd&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.config.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;publish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm publish&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --runInBand --debug&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hhd&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;dist&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.21.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;babel-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^9.1.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;core-js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;user-agent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.79.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/plugin-transform-arrow-functions&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.22.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/plugin-transform-modules-umd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.22.5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/preset-env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.22.9&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^29.5.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jest-environment-jsdom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^29.5.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="jest-config-js" tabindex="-1"><a class="header-anchor" href="#jest-config-js" aria-hidden="true">#</a> jest.config.js</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">roots</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./test&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">testRegex</span><span class="token operator">:</span> <span class="token string">&#39;(/__tests__/.*|(\\\\.|/)(test|spec))\\\\.(jsx?|tsx?)$&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">moduleFileExtensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;json&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;node&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// Jest \u9ED8\u8BA4\u4F7F\u7528\u7684\u662F Node.js \u73AF\u5883\uFF0C\u8BE5\u73AF\u5883\u4E2D\u6CA1\u6709 document \u5BF9\u8C61\u3002</span>
    <span class="token comment">//  Jest \u7684\u914D\u7F6E\u6587\u4EF6\u4E2D\u6307\u5B9A\u4F7F\u7528 jsdom \u73AF\u5883\uFF0Cjsdom \u662F\u4E00\u4E2A\u6A21\u62DF\u6D4F\u89C8\u5668\u73AF\u5883\u7684\u5E93\uFF0C\u53EF\u4EE5\u5728 Node.js \u4E2D\u4F7F\u7528</span>
    <span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">&#39;jsdom&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,136);function B(M,z){const a=o("RouterLink");return c(),l("div",null,[r,n("nav",k,[n("ul",null,[n("li",null,[t(a,{to:"#\u6982\u8FF0"},{default:p(()=>[d]),_:1})]),n("li",null,[t(a,{to:"#\u5B9E\u73B0\u601D\u8DEF"},{default:p(()=>[v]),_:1}),n("ul",null,[n("li",null,[t(a,{to:"#\u5B9E\u73B0\u601D\u8DEF\u68B3\u7406"},{default:p(()=>[m]),_:1})])])]),n("li",null,[t(a,{to:"#\u4EE3\u7801\u7ED3\u6784"},{default:p(()=>[b]),_:1})]),n("li",null,[t(a,{to:"#\u6570\u636E\u7ED3\u6784\u8BBE\u8BA1"},{default:p(()=>[y]),_:1}),n("ul",null,[n("li",null,[t(a,{to:"#\u516C\u5171\u6570\u636E"},{default:p(()=>[g]),_:1})]),n("li",null,[t(a,{to:"#\u7A33\u5B9A\u6027\u76D1\u63A7"},{default:p(()=>[h]),_:1})]),n("li",null,[t(a,{to:"#\u57CB\u70B9\u4E0A\u62A5"},{default:p(()=>[f]),_:1})]),n("li",null,[t(a,{to:"#\u7528\u6237\u505C\u7559\u53CApv\u4E0A\u62A5"},{default:p(()=>[w]),_:1})]),n("li",null,[t(a,{to:"#\u6027\u80FD\u6307\u6807\u76D1\u63A7"},{default:p(()=>[q]),_:1})]),n("li",null,[t(a,{to:"#\u957F\u4EFB\u52A1\u76D1\u63A7-\u5361\u987F"},{default:p(()=>[x]),_:1})])])]),n("li",null,[t(a,{to:"#\u6838\u5FC3\u529F\u80FD\u6A21\u5757\u8BBE\u8BA1"},{default:p(()=>[j]),_:1}),n("ul",null,[n("li",null,[t(a,{to:"#javascript\u9519\u8BEF\u76D1\u63A7"},{default:p(()=>[T]),_:1})]),n("li",null,[t(a,{to:"#\u767D\u5C4F\u76D1\u63A7"},{default:p(()=>[_]),_:1})]),n("li",null,[t(a,{to:"#fetch-\u8BF7\u6C42\u76D1\u63A7-1"},{default:p(()=>[E]),_:1})]),n("li",null,[t(a,{to:"#xhr-\u8BF7\u6C42\u76D1\u63A7-1"},{default:p(()=>[S]),_:1})]),n("li",null,[t(a,{to:"#\u9875\u9762\u505C\u7559\u548C\u8BBF\u95EE\u4E0A\u62A5"},{default:p(()=>[P]),_:1})]),n("li",null,[t(a,{to:"#\u957F\u4EFB\u52A1\u76D1\u63A7-\u5361\u987F-1"},{default:p(()=>[L]),_:1})]),n("li",null,[t(a,{to:"#\u52A0\u8F7D\u65F6\u95F4\u548C\u6027\u80FD\u6307\u6807\u76D1\u63A7"},{default:p(()=>[R]),_:1})]),n("li",null,[t(a,{to:"#\u57CB\u70B9\u4E0A\u62A5-1"},{default:p(()=>[C]),_:1})]),n("li",null,[t(a,{to:"#\u6570\u636E\u4E0A\u62A5-1"},{default:p(()=>[D]),_:1})]),n("li",null,[t(a,{to:"#\u5DE5\u5177\u7C7B"},{default:p(()=>[I]),_:1})]),n("li",null,[t(a,{to:"#\u5165\u53E3\u6587\u4EF6"},{default:p(()=>[F]),_:1})]),n("li",null,[t(a,{to:"#jest\u5355\u5143\u6D4B\u8BD5\u6848\u4F8B"},{default:p(()=>[O]),_:1})]),n("li",null,[t(a,{to:"#\u9879\u76EE\u914D\u7F6E\u6587\u4EF6"},{default:p(()=>[H]),_:1})])])])])]),N])}var J=e(u,[["render",B],["__file","monitorSDK.html.vue"]]);export{J as default};
