import{_ as t,r as e,o,c,b as s,a as i,e as a,d as n}from"./app.4c8b15c1.js";const l={},u=a('<h1 id="qiankun\u5FAE\u524D\u7AEF\u5FEB\u901F\u4E0A\u624B\u6307\u5357" tabindex="-1"><a class="header-anchor" href="#qiankun\u5FAE\u524D\u7AEF\u5FEB\u901F\u4E0A\u624B\u6307\u5357" aria-hidden="true">#</a> qiankun\u5FAE\u524D\u7AEF\u5FEB\u901F\u4E0A\u624B\u6307\u5357</h1><h2 id="\u{1F4CB}-\u76EE\u5F55" tabindex="-1"><a class="header-anchor" href="#\u{1F4CB}-\u76EE\u5F55" aria-hidden="true">#</a> \u{1F4CB} \u76EE\u5F55</h2><ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFqiankun%E5%BE%AE%E5%89%8D%E7%AB%AF">\u4EC0\u4E48\u662Fqiankun\u5FAE\u524D\u7AEF</a></li><li><a href="#qiankun%E7%9A%84%E4%B8%BB%E8%A6%81%E8%83%BD%E5%8A%9B">qiankun\u7684\u4E3B\u8981\u80FD\u529B</a></li><li><a href="#%E9%80%82%E5%90%88%E8%A7%A3%E5%86%B3%E7%9A%84%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98">\u9002\u5408\u89E3\u51B3\u7684\u9879\u76EE\u95EE\u9898</a></li><li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">\u6838\u5FC3\u6982\u5FF5</a></li><li><a href="#%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F">\u901A\u4FE1\u65B9\u5F0F</a></li><li><a href="#%E8%B7%AF%E7%94%B1%E7%AE%A1%E7%90%86">\u8DEF\u7531\u7BA1\u7406</a></li><li><a href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">\u5FEB\u901F\u5165\u95E8</a></li><li><a href="#%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BA%E5%BE%AE%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE">\u4ECE\u96F6\u642D\u5EFA\u5FAE\u524D\u7AEF\u9879\u76EE</a></li><li><a href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8Bjq%E4%B8%BB%E5%BA%94%E7%94%A8react%E5%AD%90%E5%BA%94%E7%94%A8">\u5B9E\u6218\u6848\u4F8B\uFF1AJQ\u4E3B\u5E94\u7528+React\u5B50\u5E94\u7528</a></li><li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">\u5E38\u89C1\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848</a></li><li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">\u6700\u4F73\u5B9E\u8DF5</a></li></ul><h2 id="\u4EC0\u4E48\u662Fqiankun\u5FAE\u524D\u7AEF" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662Fqiankun\u5FAE\u524D\u7AEF" aria-hidden="true">#</a> \u4EC0\u4E48\u662Fqiankun\u5FAE\u524D\u7AEF</h2>',4),r=n("qiankun \u662F\u4E00\u4E2A\u57FA\u4E8E "),k={href:"https://github.com/single-spa/single-spa",target:"_blank",rel:"noopener noreferrer"},d=n("single-spa"),v=n(" \u7684"),m=s("strong",null,"\u5FAE\u524D\u7AEF\u5B9E\u73B0\u5E93",-1),b=n("\uFF0C\u65E8\u5728\u5E2E\u52A9\u5927\u5BB6\u80FD\u66F4\u7B80\u5355\u3001\u65E0\u75DB\u7684\u6784\u5EFA\u4E00\u4E2A\u751F\u4EA7\u53EF\u7528\u5FAE\u524D\u7AEF\u67B6\u6784\u7CFB\u7EDF\u3002"),g=a(`<h3 id="\u6838\u5FC3\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#\u6838\u5FC3\u7279\u6027" aria-hidden="true">#</a> \u6838\u5FC3\u7279\u6027</h3><ul><li>\u{1F525} <strong>\u6280\u672F\u6808\u65E0\u5173</strong>\uFF1A\u4E3B\u6846\u67B6\u4E0D\u9650\u5236\u63A5\u5165\u5E94\u7528\u7684\u6280\u672F\u6808\uFF0C\u5FAE\u5E94\u7528\u5177\u5907\u5B8C\u5168\u81EA\u4E3B\u6743</li><li>\u{1F4E6} <strong>\u72EC\u7ACB\u5F00\u53D1\u3001\u72EC\u7ACB\u90E8\u7F72</strong>\uFF1A\u5FAE\u5E94\u7528\u4ED3\u5E93\u72EC\u7ACB\uFF0C\u524D\u540E\u7AEF\u53EF\u72EC\u7ACB\u5F00\u53D1\uFF0C\u90E8\u7F72\u5B8C\u6210\u540E\u4E3B\u6846\u67B6\u81EA\u52A8\u5B8C\u6210\u540C\u6B65\u66F4\u65B0</li><li>\u{1F371} <strong>\u589E\u91CF\u5347\u7EA7</strong>\uFF1A\u5728\u9762\u5BF9\u5404\u79CD\u590D\u6742\u573A\u666F\u65F6\uFF0C\u901A\u5E38\u5F88\u96BE\u5BF9\u4E00\u4E2A\u5DF2\u7ECF\u5B58\u5728\u7684\u7CFB\u7EDF\u505A\u5168\u91CF\u7684\u6280\u672F\u6808\u5347\u7EA7\u6216\u91CD\u6784\uFF0C\u800C\u5FAE\u524D\u7AEF\u662F\u4E00\u79CD\u975E\u5E38\u597D\u7684\u5B9E\u65BD\u6E10\u8FDB\u5F0F\u91CD\u6784\u7684\u624B\u6BB5\u548C\u7B56\u7565</li><li>\u{1F6E1} <strong>\u7EDF\u4E00\u8DEF\u7531</strong>\uFF1A\u89E3\u51B3\u4E86 SPA \u5E94\u7528\u8DEF\u7531\u4E4B\u95F4\u7684\u51B2\u7A81\u95EE\u9898\uFF0C\u539F\u6709\u8DEF\u7531\u65B9\u5F0F\u4E0D\u53D8\uFF0C\u4ECE\u800C\u89E3\u51B3\u4E86\u8DEF\u7531\u6B7B\u5FAA\u73AF\u3001\u9875\u9762\u767D\u5C4F\u7B49\u95EE\u9898</li><li>\u{1F3AF} <strong>\u7B80\u5355\u6613\u7528</strong>\uFF1A\u63D0\u4F9B\u4E86\u5B8C\u5907\u7684 JS SDK\uFF0C\u63A5\u5165\u7B80\u5355</li></ul><h2 id="qiankun\u7684\u4E3B\u8981\u80FD\u529B" tabindex="-1"><a class="header-anchor" href="#qiankun\u7684\u4E3B\u8981\u80FD\u529B" aria-hidden="true">#</a> qiankun\u7684\u4E3B\u8981\u80FD\u529B</h2><h3 id="_1-\u5E94\u7528\u9694\u79BB\u80FD\u529B" tabindex="-1"><a class="header-anchor" href="#_1-\u5E94\u7528\u9694\u79BB\u80FD\u529B" aria-hidden="true">#</a> 1. \u5E94\u7528\u9694\u79BB\u80FD\u529B</h3><ul><li><strong>\u6837\u5F0F\u9694\u79BB</strong>\uFF1A\u786E\u4FDD\u5FAE\u5E94\u7528\u95F4\u7684\u6837\u5F0F\u4E0D\u76F8\u4E92\u5F71\u54CD</li><li><strong>JS\u9694\u79BB</strong>\uFF1A\u6BCF\u4E2A\u5FAE\u5E94\u7528\u90FD\u6709\u72EC\u7ACB\u7684\u5168\u5C40\u6267\u884C\u73AF\u5883</li><li><strong>DOM\u9694\u79BB</strong>\uFF1A\u5FAE\u5E94\u7528\u7684DOM\u64CD\u4F5C\u5C40\u9650\u5728\u6307\u5B9A\u5BB9\u5668\u5185</li></ul><h3 id="_2-\u5E94\u7528\u901A\u4FE1\u80FD\u529B" tabindex="-1"><a class="header-anchor" href="#_2-\u5E94\u7528\u901A\u4FE1\u80FD\u529B" aria-hidden="true">#</a> 2. \u5E94\u7528\u901A\u4FE1\u80FD\u529B</h3><ul><li><strong>\u5168\u5C40\u72B6\u6001\u7BA1\u7406</strong>\uFF1A\u63D0\u4F9B\u8DE8\u5E94\u7528\u7684\u72B6\u6001\u5171\u4EAB\u673A\u5236</li><li><strong>\u4E8B\u4EF6\u603B\u7EBF</strong>\uFF1A\u652F\u6301\u5FAE\u5E94\u7528\u95F4\u7684\u6D88\u606F\u4F20\u9012</li><li><strong>Props\u4F20\u9012</strong>\uFF1A\u4E3B\u5E94\u7528\u53EF\u5411\u5B50\u5E94\u7528\u4F20\u9012\u521D\u59CB\u5316\u6570\u636E</li></ul><h3 id="_3-\u8DEF\u7531\u7BA1\u7406\u80FD\u529B" tabindex="-1"><a class="header-anchor" href="#_3-\u8DEF\u7531\u7BA1\u7406\u80FD\u529B" aria-hidden="true">#</a> 3. \u8DEF\u7531\u7BA1\u7406\u80FD\u529B</h3><ul><li><strong>\u7EDF\u4E00\u8DEF\u7531</strong>\uFF1A\u4E3B\u5E94\u7528\u7EDF\u4E00\u7BA1\u7406\u6240\u6709\u8DEF\u7531\u89C4\u5219</li><li><strong>\u8DEF\u7531\u5206\u53D1</strong>\uFF1A\u6839\u636E\u8DEF\u7531\u89C4\u5219\u81EA\u52A8\u52A0\u8F7D\u5BF9\u5E94\u7684\u5FAE\u5E94\u7528</li><li><strong>Browser History</strong>\uFF1A\u652F\u6301\u6D4F\u89C8\u5668\u539F\u751F\u8DEF\u7531\u529F\u80FD</li></ul><h3 id="_4-\u751F\u547D\u5468\u671F\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#_4-\u751F\u547D\u5468\u671F\u7BA1\u7406" aria-hidden="true">#</a> 4. \u751F\u547D\u5468\u671F\u7BA1\u7406</h3><ul><li><strong>\u52A8\u6001\u52A0\u8F7D</strong>\uFF1A\u6309\u9700\u52A0\u8F7D\u5FAE\u5E94\u7528\u8D44\u6E90</li><li><strong>\u751F\u547D\u5468\u671F\u94A9\u5B50</strong>\uFF1A\u5B8C\u6574\u7684\u5E94\u7528\u52A0\u8F7D\u3001\u6302\u8F7D\u3001\u5378\u8F7D\u751F\u547D\u5468\u671F</li><li><strong>\u8D44\u6E90\u7BA1\u7406</strong>\uFF1A\u81EA\u52A8\u5904\u7406\u5FAE\u5E94\u7528\u7684\u8D44\u6E90\u52A0\u8F7D\u548C\u6E05\u7406</li></ul><h2 id="\u9002\u5408\u89E3\u51B3\u7684\u9879\u76EE\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u9002\u5408\u89E3\u51B3\u7684\u9879\u76EE\u95EE\u9898" aria-hidden="true">#</a> \u9002\u5408\u89E3\u51B3\u7684\u9879\u76EE\u95EE\u9898</h2><h3 id="_1-\u5927\u578B\u5355\u4F53\u5E94\u7528\u62C6\u5206" tabindex="-1"><a class="header-anchor" href="#_1-\u5927\u578B\u5355\u4F53\u5E94\u7528\u62C6\u5206" aria-hidden="true">#</a> 1. \u5927\u578B\u5355\u4F53\u5E94\u7528\u62C6\u5206</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>\u95EE\u9898\uFF1A\u5355\u4F53\u5E94\u7528\u8FC7\u4E8E\u5E9E\u5927\uFF0C\u5F00\u53D1\u7EF4\u62A4\u56F0\u96BE
\u89E3\u51B3\uFF1A\u5C06\u5927\u578B\u5E94\u7528\u6309\u4E1A\u52A1\u6A21\u5757\u62C6\u5206\u4E3A\u591A\u4E2A\u5FAE\u5E94\u7528
\u4F18\u52BF\uFF1A
<span class="token list punctuation">-</span> \u964D\u4F4E\u4EE3\u7801\u590D\u6742\u5EA6
<span class="token list punctuation">-</span> \u63D0\u9AD8\u5F00\u53D1\u6548\u7387
<span class="token list punctuation">-</span> \u4FBF\u4E8E\u56E2\u961F\u534F\u4F5C
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u591A\u6280\u672F\u6808\u5171\u5B58" tabindex="-1"><a class="header-anchor" href="#_2-\u591A\u6280\u672F\u6808\u5171\u5B58" aria-hidden="true">#</a> 2. \u591A\u6280\u672F\u6808\u5171\u5B58</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>\u95EE\u9898\uFF1A\u9879\u76EE\u4E2D\u9700\u8981\u4F7F\u7528\u4E0D\u540C\u7684\u6280\u672F\u6808
\u89E3\u51B3\uFF1A\u4E0D\u540C\u6A21\u5757\u4F7F\u7528\u4E0D\u540C\u6280\u672F\u6808\u5F00\u53D1\uFF0C\u901A\u8FC7qiankun\u96C6\u6210
\u4F18\u52BF\uFF1A
<span class="token list punctuation">-</span> \u6280\u672F\u9009\u578B\u7075\u6D3B
<span class="token list punctuation">-</span> \u56E2\u961F\u6280\u80FD\u5229\u7528\u6700\u5927\u5316
<span class="token list punctuation">-</span> \u6E10\u8FDB\u5F0F\u6280\u672F\u5347\u7EA7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u56E2\u961F\u534F\u4F5C\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3-\u56E2\u961F\u534F\u4F5C\u95EE\u9898" aria-hidden="true">#</a> 3. \u56E2\u961F\u534F\u4F5C\u95EE\u9898</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>\u95EE\u9898\uFF1A\u591A\u56E2\u961F\u5F00\u53D1\u540C\u4E00\u4E2A\u9879\u76EE\uFF0C\u4EE3\u7801\u51B2\u7A81\u9891\u7E41
\u89E3\u51B3\uFF1A\u6BCF\u4E2A\u56E2\u961F\u8D1F\u8D23\u72EC\u7ACB\u7684\u5FAE\u5E94\u7528
\u4F18\u52BF\uFF1A
<span class="token list punctuation">-</span> \u4EE3\u7801\u4ED3\u5E93\u9694\u79BB
<span class="token list punctuation">-</span> \u72EC\u7ACB\u5F00\u53D1\u90E8\u7F72
<span class="token list punctuation">-</span> \u51CF\u5C11\u534F\u4F5C\u6210\u672C
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-\u9057\u7559\u7CFB\u7EDF\u6539\u9020" tabindex="-1"><a class="header-anchor" href="#_4-\u9057\u7559\u7CFB\u7EDF\u6539\u9020" aria-hidden="true">#</a> 4. \u9057\u7559\u7CFB\u7EDF\u6539\u9020</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>\u95EE\u9898\uFF1A\u8001\u7CFB\u7EDF\u6280\u672F\u6808\u8FC7\u65F6\uFF0C\u5168\u91CF\u91CD\u5199\u6210\u672C\u9AD8
\u89E3\u51B3\uFF1A\u4FDD\u7559\u539F\u6709\u7CFB\u7EDF\uFF0C\u65B0\u529F\u80FD\u7528\u65B0\u6280\u672F\u6808\u5F00\u53D1
\u4F18\u52BF\uFF1A
<span class="token list punctuation">-</span> \u6E10\u8FDB\u5F0F\u5347\u7EA7
<span class="token list punctuation">-</span> \u964D\u4F4E\u6539\u9020\u98CE\u9669
<span class="token list punctuation">-</span> \u6700\u5927\u5316\u590D\u7528\u73B0\u6709\u4EE3\u7801
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6838\u5FC3\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#\u6838\u5FC3\u6982\u5FF5" aria-hidden="true">#</a> \u6838\u5FC3\u6982\u5FF5</h2><h3 id="\u4E3B\u5E94\u7528-main-app" tabindex="-1"><a class="header-anchor" href="#\u4E3B\u5E94\u7528-main-app" aria-hidden="true">#</a> \u4E3B\u5E94\u7528 (Main App)</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4E3B\u5E94\u7528\u804C\u8D23</span>
<span class="token keyword">const</span> mainApp <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">responsibilities</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;\u6CE8\u518C\u5E76\u7BA1\u7406\u5FAE\u5E94\u7528&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;\u63D0\u4F9B\u5FAE\u5E94\u7528\u8FD0\u884C\u5BB9\u5668&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;\u5904\u7406\u8DEF\u7531\u5206\u53D1&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;\u63D0\u4F9B\u5168\u5C40\u72B6\u6001\u7BA1\u7406&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;\u7EDF\u4E00\u7684\u7528\u6237\u8BA4\u8BC1\u548C\u6743\u9650\u63A7\u5236&#39;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5FAE\u5E94\u7528-micro-app" tabindex="-1"><a class="header-anchor" href="#\u5FAE\u5E94\u7528-micro-app" aria-hidden="true">#</a> \u5FAE\u5E94\u7528 (Micro App)</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5FAE\u5E94\u7528\u804C\u8D23</span>
<span class="token keyword">const</span> microApp <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">responsibilities</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;\u5B9E\u73B0\u5177\u4F53\u7684\u4E1A\u52A1\u529F\u80FD&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;\u66B4\u9732\u751F\u547D\u5468\u671F\u94A9\u5B50&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;\u5904\u7406\u81EA\u8EAB\u7684\u72B6\u6001\u7BA1\u7406&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;\u4E0E\u4E3B\u5E94\u7528\u8FDB\u884C\u901A\u4FE1&#39;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u751F\u547D\u5468\u671F" tabindex="-1"><a class="header-anchor" href="#\u751F\u547D\u5468\u671F" aria-hidden="true">#</a> \u751F\u547D\u5468\u671F</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5FAE\u5E94\u7528\u751F\u547D\u5468\u671F</span>
<span class="token keyword">const</span> lifecycle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">bootstrap</span><span class="token operator">:</span> <span class="token string">&#39;\u5E94\u7528\u521D\u59CB\u5316\uFF0C\u53EA\u4F1A\u8C03\u7528\u4E00\u6B21&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mount</span><span class="token operator">:</span> <span class="token string">&#39;\u5E94\u7528\u6302\u8F7D\uFF0C\u6BCF\u6B21\u8FDB\u5165\u90FD\u4F1A\u8C03\u7528&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">unmount</span><span class="token operator">:</span> <span class="token string">&#39;\u5E94\u7528\u5378\u8F7D\uFF0C\u6BCF\u6B21\u79BB\u5F00\u90FD\u4F1A\u8C03\u7528&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">update</span><span class="token operator">:</span> <span class="token string">&#39;\u5E94\u7528\u66F4\u65B0\uFF0C\u53EF\u9009\u5B9E\u73B0&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u901A\u4FE1\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u901A\u4FE1\u65B9\u5F0F" aria-hidden="true">#</a> \u901A\u4FE1\u65B9\u5F0F</h2><h3 id="_1-props\u4F20\u9012-\u7236\u2192\u5B50" tabindex="-1"><a class="header-anchor" href="#_1-props\u4F20\u9012-\u7236\u2192\u5B50" aria-hidden="true">#</a> 1. Props\u4F20\u9012\uFF08\u7236\u2192\u5B50\uFF09</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4E3B\u5E94\u7528\u4F20\u9012\u6570\u636E\u7ED9\u5FAE\u5E94\u7528</span>
<span class="token function">loadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;react-app&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//localhost:3000&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">&#39;#subapp-container&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;\u5F20\u4E09&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&#39;admin&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">primaryColor</span><span class="token operator">:</span> <span class="token string">&#39;#1890ff&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globalState</span><span class="token operator">:</span> globalStateManager
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5FAE\u5E94\u7528\u63A5\u6536\u6570\u636E</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> theme<span class="token punctuation">,</span> globalState <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u7528\u6237\u4FE1\u606F:&#39;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u4E3B\u9898\u914D\u7F6E:&#39;</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u5168\u5C40\u72B6\u6001-\u53CC\u5411\u901A\u4FE1" tabindex="-1"><a class="header-anchor" href="#_2-\u5168\u5C40\u72B6\u6001-\u53CC\u5411\u901A\u4FE1" aria-hidden="true">#</a> 2. \u5168\u5C40\u72B6\u6001\uFF08\u53CC\u5411\u901A\u4FE1\uFF09</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4E3B\u5E94\u7528\uFF1A\u521D\u59CB\u5316\u5168\u5C40\u72B6\u6001</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> initGlobalState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;qiankun&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token function">initGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;\u5F20\u4E09&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&#39;admin&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">&#39;dark&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u76D1\u542C\u5168\u5C40\u72B6\u6001\u53D8\u5316</span>
actions<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u72B6\u6001\u53D8\u5316:&#39;</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5FAE\u5E94\u7528\uFF1A\u4F7F\u7528\u5168\u5C40\u72B6\u6001</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> onGlobalStateChange<span class="token punctuation">,</span> setGlobalState <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  
  <span class="token comment">// \u76D1\u542C\u72B6\u6001\u53D8\u5316</span>
  <span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u5FAE\u5E94\u7528\u6536\u5230\u72B6\u6001\u53D8\u5316:&#39;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// \u66F4\u65B0\u5168\u5C40\u72B6\u6001</span>
  <span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;\u674E\u56DB&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u4E8B\u4EF6\u603B\u7EBF-\u81EA\u5B9A\u4E49\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-\u4E8B\u4EF6\u603B\u7EBF-\u81EA\u5B9A\u4E49\u5B9E\u73B0" aria-hidden="true">#</a> 3. \u4E8B\u4EF6\u603B\u7EBF\uFF08\u81EA\u5B9A\u4E49\u5B9E\u73B0\uFF09</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4E8B\u4EF6\u603B\u7EBF\u5B9E\u73B0</span>
<span class="token keyword">class</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> cb <span class="token operator">!==</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u4F7F\u7528\u793A\u4F8B</span>
<span class="token keyword">const</span> eventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>eventBus <span class="token operator">=</span> eventBus<span class="token punctuation">;</span> <span class="token comment">// \u6302\u8F7D\u5230\u5168\u5C40</span>

<span class="token comment">// \u5FAE\u5E94\u7528A\u53D1\u9001\u6D88\u606F</span>
window<span class="token punctuation">.</span>eventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;user-login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">userId</span><span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5FAE\u5E94\u7528B\u63A5\u6536\u6D88\u606F</span>
window<span class="token punctuation">.</span>eventBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;user-login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u7528\u6237\u767B\u5F55:&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u8DEF\u7531\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u8DEF\u7531\u7BA1\u7406" aria-hidden="true">#</a> \u8DEF\u7531\u7BA1\u7406</h2><h3 id="_1-\u57FA\u4E8E\u8DEF\u7531\u7684\u5FAE\u5E94\u7528\u52A0\u8F7D" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u4E8E\u8DEF\u7531\u7684\u5FAE\u5E94\u7528\u52A0\u8F7D" aria-hidden="true">#</a> 1. \u57FA\u4E8E\u8DEF\u7531\u7684\u5FAE\u5E94\u7528\u52A0\u8F7D</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4E3B\u5E94\u7528\u8DEF\u7531\u914D\u7F6E</span>
<span class="token keyword">class</span> <span class="token class-name">RouteManager</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routeConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;/dashboard&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">needMicroApp</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;dashboard&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">microApp</span><span class="token operator">:</span> <span class="token string">&#39;react-dashboard&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&#39;/user-management&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">needMicroApp</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">microApp</span><span class="token operator">:</span> <span class="token string">&#39;vue-user&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&#39;/&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">needMicroApp</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;home&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// \u8DEF\u7531\u53D8\u5316\u5904\u7406</span>
  <span class="token keyword">async</span> <span class="token function">handleRouteChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> currentPath <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    <span class="token keyword">const</span> routeInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routeConfig<span class="token punctuation">[</span>currentPath<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>routeInfo<span class="token operator">?.</span>needMicroApp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadMicroApp</span><span class="token punctuation">(</span>routeInfo<span class="token punctuation">.</span>microApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unloadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showStaticPage</span><span class="token punctuation">(</span>routeInfo<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u52A8\u6001\u8DEF\u7531\u5339\u914D" tabindex="-1"><a class="header-anchor" href="#_2-\u52A8\u6001\u8DEF\u7531\u5339\u914D" aria-hidden="true">#</a> 2. \u52A8\u6001\u8DEF\u7531\u5339\u914D</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u652F\u6301\u52A8\u6001\u8DEF\u7531\u53C2\u6570</span>
<span class="token keyword">const</span> dynamicRoutes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/user/:id&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">microApp</span><span class="token operator">:</span> <span class="token string">&#39;user-detail&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;user-detail&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/product/:category/:id&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">microApp</span><span class="token operator">:</span> <span class="token string">&#39;product-detail&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;product&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// \u8DEF\u7531\u5339\u914D\u51FD\u6570</span>
<span class="token keyword">function</span> <span class="token function">matchRoute</span><span class="token punctuation">(</span><span class="token parameter">pathname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> route <span class="token keyword">of</span> dynamicRoutes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
      <span class="token string">&#39;^&#39;</span> <span class="token operator">+</span> route<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">:\\w+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;([^/]+)&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;$&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> match <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>route<span class="token punctuation">,</span>
        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token function">extractParams</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>path<span class="token punctuation">,</span> match<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u8DEF\u7531\u5B88\u536B" tabindex="-1"><a class="header-anchor" href="#_3-\u8DEF\u7531\u5B88\u536B" aria-hidden="true">#</a> 3. \u8DEF\u7531\u5B88\u536B</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u8DEF\u7531\u5B88\u536B\u5B9E\u73B0</span>
<span class="token keyword">class</span> <span class="token class-name">RouteGuard</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>guards <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// \u6DFB\u52A0\u8DEF\u7531\u5B88\u536B</span>
  <span class="token function">addGuard</span><span class="token punctuation">(</span><span class="token parameter">guard</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>guards<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guard<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// \u6267\u884C\u8DEF\u7531\u5B88\u536B</span>
  <span class="token keyword">async</span> <span class="token function">executeGuards</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> guard <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>guards<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">guard</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// \u963B\u6B62\u8DEF\u7531\u8DF3\u8F6C</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u4F7F\u7528\u793A\u4F8B</span>
<span class="token keyword">const</span> routeGuard <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteGuard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u6743\u9650\u68C0\u67E5\u5B88\u536B</span>
routeGuard<span class="token punctuation">.</span><span class="token function">addGuard</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;/admin&#39;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>user<span class="token punctuation">.</span>hasAdminRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&#39;/login&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5FEB\u901F\u5165\u95E8" tabindex="-1"><a class="header-anchor" href="#\u5FEB\u901F\u5165\u95E8" aria-hidden="true">#</a> \u5FEB\u901F\u5165\u95E8</h2><h3 id="_1-\u5B89\u88C5qiankun" tabindex="-1"><a class="header-anchor" href="#_1-\u5B89\u88C5qiankun" aria-hidden="true">#</a> 1. \u5B89\u88C5qiankun</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5728\u4E3B\u5E94\u7528\u4E2D\u5B89\u88C5</span>
<span class="token function">npm</span> <span class="token function">install</span> qiankun
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u4E3B\u5E94\u7528\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2-\u4E3B\u5E94\u7528\u914D\u7F6E" aria-hidden="true">#</a> 2. \u4E3B\u5E94\u7528\u914D\u7F6E</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> registerMicroApps<span class="token punctuation">,</span> start <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;qiankun&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// \u6CE8\u518C\u5FAE\u5E94\u7528</span>
<span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;react-app&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//localhost:3000&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">&#39;#subapp-container&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">activeRule</span><span class="token operator">:</span> <span class="token string">&#39;/react&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;vue-app&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//localhost:8080&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">&#39;#subapp-container&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">activeRule</span><span class="token operator">:</span> <span class="token string">&#39;/vue&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u542F\u52A8qiankun</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u5FAE\u5E94\u7528\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3-\u5FAE\u5E94\u7528\u914D\u7F6E" aria-hidden="true">#</a> 3. \u5FAE\u5E94\u7528\u914D\u7F6E</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5FAE\u5E94\u7528\u5165\u53E3\u6587\u4EF6 public-path.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  __webpack_public_path__ <span class="token operator">=</span> window<span class="token punctuation">.</span>__INJECTED_PUBLIC_PATH_BY_QIANKUN__<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u5FAE\u5E94\u7528\u4E3B\u6587\u4EF6 index.js</span>
<span class="token keyword">import</span> <span class="token string">&#39;./public-path&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> root<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">const</span> dom <span class="token operator">=</span> container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u72EC\u7ACB\u8FD0\u884C\u65F6\u76F4\u63A5\u6E32\u67D3</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u5BFC\u51FA\u751F\u547D\u5468\u671F\u51FD\u6570</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[react16] react app bootstraped&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[react16] props from main framework&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">const</span> dom <span class="token operator">=</span> container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    root<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    root <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-\u6253\u5305\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_4-\u6253\u5305\u914D\u7F6E" aria-hidden="true">#</a> 4. \u6253\u5305\u914D\u7F6E</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./package&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&#39;umd&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkLoadingGlobal</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u4ECE\u96F6\u642D\u5EFA\u5FAE\u524D\u7AEF\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#\u4ECE\u96F6\u642D\u5EFA\u5FAE\u524D\u7AEF\u9879\u76EE" aria-hidden="true">#</a> \u4ECE\u96F6\u642D\u5EFA\u5FAE\u524D\u7AEF\u9879\u76EE</h2><h3 id="\u9879\u76EE\u7ED3\u6784\u8BBE\u8BA1" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u7ED3\u6784\u8BBE\u8BA1" aria-hidden="true">#</a> \u9879\u76EE\u7ED3\u6784\u8BBE\u8BA1</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>qiankun-project/
\u251C\u2500\u2500 main-app/                 # \u4E3B\u5E94\u7528
\u2502   \u251C\u2500\u2500 src/
\u2502   \u2502   \u251C\u2500\u2500 index.html
\u2502   \u2502   \u251C\u2500\u2500 index.js
\u2502   \u2502   \u251C\u2500\u2500 RouteManager.js
\u2502   \u2502   \u2514\u2500\u2500 styles.css
\u2502   \u251C\u2500\u2500 webpack.config.js
\u2502   \u2514\u2500\u2500 package.json
\u251C\u2500\u2500 react-app/                # React\u5FAE\u5E94\u7528
\u2502   \u251C\u2500\u2500 src/
\u2502   \u2502   \u251C\u2500\u2500 index.js
\u2502   \u2502   \u251C\u2500\u2500 App.js
\u2502   \u2502   \u2514\u2500\u2500 public-path.js
\u2502   \u251C\u2500\u2500 webpack.config.js
\u2502   \u2514\u2500\u2500 package.json
\u251C\u2500\u2500 vue-app/                  # Vue\u5FAE\u5E94\u7528
\u2502   \u251C\u2500\u2500 src/
\u2502   \u2502   \u251C\u2500\u2500 main.js
\u2502   \u2502   \u251C\u2500\u2500 App.vue
\u2502   \u2502   \u2514\u2500\u2500 public-path.js
\u2502   \u251C\u2500\u2500 vue.config.js
\u2502   \u2514\u2500\u2500 package.json
\u2514\u2500\u2500 README.md
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u642D\u5EFA\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#\u642D\u5EFA\u6B65\u9AA4" aria-hidden="true">#</a> \u642D\u5EFA\u6B65\u9AA4</h3><h4 id="\u6B65\u9AA41-\u521B\u5EFA\u4E3B\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#\u6B65\u9AA41-\u521B\u5EFA\u4E3B\u5E94\u7528" aria-hidden="true">#</a> \u6B65\u9AA41: \u521B\u5EFA\u4E3B\u5E94\u7528</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u521B\u5EFA\u4E3B\u5E94\u7528\u76EE\u5F55</span>
<span class="token function">mkdir</span> main-app <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> main-app
<span class="token function">npm</span> init -y

<span class="token comment"># \u5B89\u88C5\u4F9D\u8D56</span>
<span class="token function">npm</span> <span class="token function">install</span> qiankun webpack webpack-cli webpack-dev-server html-webpack-plugin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u6B65\u9AA42-\u914D\u7F6E\u4E3B\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#\u6B65\u9AA42-\u914D\u7F6E\u4E3B\u5E94\u7528" aria-hidden="true">#</a> \u6B65\u9AA42: \u914D\u7F6E\u4E3B\u5E94\u7528</h4><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- src/index.html --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u5FAE\u524D\u7AEF\u4E3B\u5E94\u7528<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-route</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u9996\u9875<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/react<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-route</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>react<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>React\u5E94\u7528<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/vue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-route</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Vue\u5E94\u7528<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>subapp-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> registerMicroApps<span class="token punctuation">,</span> start<span class="token punctuation">,</span> loadMicroApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;qiankun&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MainApp</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentApp <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerApps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startQiankun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">registerApps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;react-app&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//localhost:3000&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">&#39;#subapp-container&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">activeRule</span><span class="token operator">:</span> <span class="token string">&#39;/react&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;vue-app&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//localhost:8080&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">&#39;#subapp-container&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">activeRule</span><span class="token operator">:</span> <span class="token string">&#39;/vue&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> route <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-route&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span>route <span class="token operator">===</span> <span class="token string">&#39;home&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>route<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRouteChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">handleRouteChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">===</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// qiankun\u4F1A\u81EA\u52A8\u5904\u7406\u5FAE\u5E94\u7528\u7684\u52A0\u8F7D</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">showHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;subapp-container&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
      &lt;h1&gt;\u6B22\u8FCE\u4F7F\u7528\u5FAE\u524D\u7AEF\u7CFB\u7EDF&lt;/h1&gt;
      &lt;p&gt;\u8BF7\u9009\u62E9\u4E00\u4E2A\u5E94\u7528\u5F00\u59CB\u4F7F\u7528&lt;/p&gt;
    </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">startQiankun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">singular</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">MainApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u6B65\u9AA43-\u521B\u5EFAreact\u5FAE\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#\u6B65\u9AA43-\u521B\u5EFAreact\u5FAE\u5E94\u7528" aria-hidden="true">#</a> \u6B65\u9AA43: \u521B\u5EFAReact\u5FAE\u5E94\u7528</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u521B\u5EFAReact\u5E94\u7528</span>
npx create-react-app react-app
<span class="token builtin class-name">cd</span> react-app

<span class="token comment"># \u5B89\u88C5\u5FC5\u8981\u4F9D\u8D56</span>
<span class="token function">npm</span> <span class="token function">install</span> react-router-dom
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/public-path.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  __webpack_public_path__ <span class="token operator">=</span> window<span class="token punctuation">.</span>__INJECTED_PUBLIC_PATH_BY_QIANKUN__<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> <span class="token string">&#39;./public-path&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom/client&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router-dom&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> root<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container<span class="token punctuation">,</span> routerBase <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">const</span> dom <span class="token operator">=</span> container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>BrowserRouter basename<span class="token operator">=</span><span class="token punctuation">{</span>routerBase <span class="token operator">||</span> <span class="token string">&#39;/react&#39;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[react16] react app bootstraped&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[react16] props from main framework&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">const</span> dom <span class="token operator">=</span> container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    root<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    root <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u6B65\u9AA44-\u914D\u7F6E\u6253\u5305" tabindex="-1"><a class="header-anchor" href="#\u6B65\u9AA44-\u914D\u7F6E\u6253\u5305" aria-hidden="true">#</a> \u6B65\u9AA44: \u914D\u7F6E\u6253\u5305</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// react-app/craco.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./package&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">webpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">configure</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      webpackConfig<span class="token punctuation">.</span>output <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>webpackConfig<span class="token punctuation">.</span>output<span class="token punctuation">,</span>
        <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&#39;umd&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunkLoadingGlobal</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> webpackConfig<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;Access-Control-Allow-Origin&#39;</span><span class="token operator">:</span> <span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5B9E\u6218\u6848\u4F8B-jq\u4E3B\u5E94\u7528-react\u5B50\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u6218\u6848\u4F8B-jq\u4E3B\u5E94\u7528-react\u5B50\u5E94\u7528" aria-hidden="true">#</a> \u5B9E\u6218\u6848\u4F8B\uFF1AJQ\u4E3B\u5E94\u7528+React\u5B50\u5E94\u7528</h2><h3 id="\u4E3B\u5E94\u7528-jquery-\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#\u4E3B\u5E94\u7528-jquery-\u5B9E\u73B0" aria-hidden="true">#</a> \u4E3B\u5E94\u7528\uFF08jQuery\uFF09\u5B9E\u73B0</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main-app/src/RouteManager.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> registerMicroApps<span class="token punctuation">,</span> start<span class="token punctuation">,</span> loadMicroApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;qiankun&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&#39;jquery&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RouteManager</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentApp <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isQiankunStarted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRouteChanging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>routeConfig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRouteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getRouteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&#39;/data-market&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">needMicroApp</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;data-market&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;\u6570\u636E\u96C6\u5E02&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;\u6570\u636E\u8D44\u6E90\u7BA1\u7406\u548C\u5206\u6790&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&#39;/analytics&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">needMicroApp</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;analytics&#39;</span><span class="token punctuation">,</span> 
                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;\u6570\u636E\u5206\u6790&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;\u667A\u80FD\u6570\u636E\u5206\u6790\u5DE5\u5177&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&#39;/&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">needMicroApp</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;home&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;\u9996\u9875&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;\u4F01\u4E1A\u6570\u636E\u5E73\u53F0\u9996\u9875&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleInitialRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u76D1\u542C\u6D4F\u89C8\u5668\u524D\u8FDB\u540E\u9000</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;popstate&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRouteChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u62E6\u622A\u94FE\u63A5\u70B9\u51FB\u548C\u5BFC\u822A\u9879\u70B9\u51FB</span>
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5904\u7406\u5BFC\u822A\u94FE\u63A5\u70B9\u51FB</span>
            <span class="token keyword">const</span> link <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">&#39;a[href^=&quot;/&quot;], .nav-link&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>link <span class="token operator">&amp;&amp;</span> link<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;href&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> href <span class="token operator">=</span> link<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;href&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">// \u5904\u7406\u5BFC\u822A\u9879\u70B9\u51FB\uFF08\u5305\u62EC nav-item \u5BB9\u5668\uFF09</span>
            <span class="token keyword">const</span> navItem <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">&#39;.nav-item&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>navItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> route <span class="token operator">=</span> navItem<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-route&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> routePath <span class="token operator">=</span> route <span class="token operator">===</span> <span class="token string">&#39;home&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>route<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span>routePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname <span class="token operator">===</span> path<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        
        history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRouteChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">handleRouteChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u9632\u6B62\u5E76\u53D1\u8DEF\u7531\u53D8\u5316</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isRouteChanging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u8DEF\u7531\u53D8\u5316\u6B63\u5728\u8FDB\u884C\u4E2D\uFF0C\u8DF3\u8FC7\u6B64\u6B21\u8BF7\u6C42&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRouteChanging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> currentPath <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
            <span class="token keyword">const</span> routeInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routeConfig<span class="token punctuation">[</span>currentPath<span class="token punctuation">]</span><span class="token punctuation">;</span>

            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u8DEF\u7531\u53D8\u5316:&#39;</span><span class="token punctuation">,</span> currentPath<span class="token punctuation">,</span> routeInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// \u66F4\u65B0\u5BFC\u822A\u72B6\u6001</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateNavigation</span><span class="token punctuation">(</span>currentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>routeInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">show404Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// \u66F4\u65B0\u9875\u9762\u6807\u9898</span>
            document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\u4F01\u4E1A\u6570\u636E\u5E73\u53F0 - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>routeInfo<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>routeInfo<span class="token punctuation">.</span>needMicroApp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u51C6\u5907\u52A0\u8F7D\u5FAE\u5E94\u7528:&#39;</span><span class="token punctuation">,</span> routeInfo<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadMicroApp</span><span class="token punctuation">(</span>routeInfo<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u51C6\u5907\u663E\u793A\u9759\u6001\u9875\u9762:&#39;</span><span class="token punctuation">,</span> routeInfo<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unloadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showStaticPage</span><span class="token punctuation">(</span>routeInfo<span class="token punctuation">.</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isRouteChanging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">loadMicroApp</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;loadMicroApp \u5F00\u59CB\u6267\u884C\uFF0C\u7EC4\u4EF6:&#39;</span><span class="token punctuation">,</span> component<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// \u5982\u679C\u5DF2\u6709\u5E94\u7528\u5728\u8FD0\u884C\uFF0C\u5148\u5378\u8F7D</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentApp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u68C0\u6D4B\u5230\u5F53\u524D\u5E94\u7528\u5B58\u5728\uFF0C\u51C6\u5907\u5378\u8F7D&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unloadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// \u663E\u793A\u52A0\u8F7D\u72B6\u6001</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// \u542F\u52A8qiankun\uFF08\u5982\u679C\u8FD8\u672A\u542F\u52A8\uFF09</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isQiankunStarted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startQiankun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>isQiankunStarted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// \u663E\u793A\u5FAE\u5E94\u7528\u5BB9\u5668</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showMicroAppContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// \u4F7F\u7528loadMicroApp\u52A8\u6001\u52A0\u8F7D</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentApp <span class="token operator">=</span> <span class="token function">loadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">react-app-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>component<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token comment">// \u4F7F\u7528\u7EC4\u4EF6\u540D\u79F0\u4F5C\u4E3A\u552F\u4E00\u6807\u8BC6</span>
                <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//localhost:3000&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">&#39;#subapp-container&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">routerBase</span><span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span>
                    <span class="token literal-property property">component</span><span class="token operator">:</span> component<span class="token punctuation">,</span>
                    <span class="token literal-property property">getGlobalState</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getGlobalState</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// \u7B49\u5F85\u52A0\u8F7D\u5B8C\u6210</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentApp<span class="token punctuation">.</span>mountPromise<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\u5FAE\u5E94\u7528\u5DF2\u52A0\u8F7D\uFF0C\u7EC4\u4EF6: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>component<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;\u52A0\u8F7D\u5FAE\u5E94\u7528\u5931\u8D25:&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showErrorPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">unloadMicroApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentApp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u5F00\u59CB\u5378\u8F7D\u5FAE\u5E94\u7528...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u8BBE\u7F6E\u8D85\u65F6\uFF0C\u5982\u679C3\u79D2\u5185\u65E0\u6CD5\u5378\u8F7D\u5C31\u5F3A\u5236\u6E05\u7406</span>
                <span class="token keyword">const</span> unmountPromise <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentApp<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> timeoutPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;\u5378\u8F7D\u8D85\u65F6&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>unmountPromise<span class="token punctuation">,</span> timeoutPromise<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u5FAE\u5E94\u7528\u5DF2\u5378\u8F7D&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;\u5378\u8F7D\u5FAE\u5E94\u7528\u5931\u8D25:&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u65E0\u8BBA\u5982\u4F55\u90FD\u8981\u6E05\u7A7A\u5E94\u7528\u5F15\u7528\u548C\u5BB9\u5668</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>currentApp <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// \u786E\u4FDD\u6E05\u7A7A\u5FAE\u5E94\u7528\u5BB9\u5668\u5185\u5BB9</span>
        <span class="token keyword">const</span> $container <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#39;#subapp-container&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>$container<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            $container<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u5FAE\u5E94\u7528\u5BB9\u5668\u5DF2\u6E05\u7406&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u83B7\u53D6\u5168\u5C40\u72B6\u6001</span>
    <span class="token function">getGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;\u7BA1\u7406\u5458&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&#39;admin&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">primaryColor</span><span class="token operator">:</span> <span class="token string">&#39;#48bb78&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">&#39;#f8fffe&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> RouteManager<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="react\u5B50\u5E94\u7528\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#react\u5B50\u5E94\u7528\u5B9E\u73B0" aria-hidden="true">#</a> React\u5B50\u5E94\u7528\u5B9E\u73B0</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// react-app/src/index.js</span>
<span class="token keyword">import</span> <span class="token string">&#39;./public-path&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom/client&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router-dom&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> root<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> container<span class="token punctuation">,</span> routerBase <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> dom <span class="token operator">=</span> container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[react-app] \u6E32\u67D3\u53C2\u6570:&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> container<span class="token punctuation">,</span> routerBase<span class="token punctuation">,</span> dom <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root <span class="token operator">&amp;&amp;</span> dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>BrowserRouter basename<span class="token operator">=</span><span class="token punctuation">{</span>routerBase <span class="token operator">||</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>App <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u72EC\u7ACB\u8FD0\u884C\u65F6</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// qiankun\u751F\u547D\u5468\u671F</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[react-app] \u5E94\u7528\u542F\u52A8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[react-app] \u5E94\u7528\u6302\u8F7D&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;[react-app] \u5E94\u7528\u5378\u8F7D&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        root<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// react-app/src/App.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ComponentRouter <span class="token keyword">from</span> <span class="token string">&#39;./components/ComponentRouter&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token parameter">props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>globalState<span class="token punctuation">,</span> setGlobalState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;App: \u63A5\u6536\u5230props&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// \u83B7\u53D6\u5168\u5C40\u72B6\u6001</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>getGlobalState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> state <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">getGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setGlobalState</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u5B50\u5E94\u7528\u63A5\u6536\u5230\u5168\u5C40\u72B6\u6001:&#39;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;micro-app&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ComponentRouter <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u7EC4\u4EF6\u8DEF\u7531\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#\u7EC4\u4EF6\u8DEF\u7531\u5B9E\u73B0" aria-hidden="true">#</a> \u7EC4\u4EF6\u8DEF\u7531\u5B9E\u73B0</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// react-app/src/components/ComponentRouter.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> DataMarket <span class="token keyword">from</span> <span class="token string">&#39;./DataMarket&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Analytics <span class="token keyword">from</span> <span class="token string">&#39;./Analytics&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Reports <span class="token keyword">from</span> <span class="token string">&#39;./Reports&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ChartModal <span class="token keyword">from</span> <span class="token string">&#39;./ChartModal&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">ComponentRouter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> component <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ComponentRouter: \u6E32\u67D3\u7EC4\u4EF6&#39;</span><span class="token punctuation">,</span> component<span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">renderComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&#39;data-market&#39;</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token operator">&lt;</span>DataMarket <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">&#39;analytics&#39;</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token operator">&lt;</span>Analytics <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">&#39;reports&#39;</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token operator">&lt;</span>Reports <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">&#39;chart-modal&#39;</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token operator">&lt;</span>ChartModal <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>\u672A\u77E5\u7EC4\u4EF6<span class="token operator">:</span> <span class="token punctuation">{</span>component<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;component-router&quot;</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token function">renderComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ComponentRouter<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5E38\u89C1\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u5E38\u89C1\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> \u5E38\u89C1\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848</h2><h3 id="_1-\u8DEF\u7531\u51B2\u7A81\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_1-\u8DEF\u7531\u51B2\u7A81\u95EE\u9898" aria-hidden="true">#</a> 1. \u8DEF\u7531\u51B2\u7A81\u95EE\u9898</h3><p><strong>\u95EE\u9898</strong>\uFF1A\u5FAE\u5E94\u7528\u8DEF\u7531\u4E0E\u4E3B\u5E94\u7528\u8DEF\u7531\u51B2\u7A81</p><p><strong>\u89E3\u51B3\u65B9\u6848</strong>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u8BBE\u7F6E\u8DEF\u7531base</span>
<span class="token operator">&lt;</span>BrowserRouter basename<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>routerBase <span class="token operator">||</span> <span class="token string">&#39;/micro-app&#39;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">&gt;</span>

<span class="token comment">// \u6216\u4F7F\u7528Hash\u8DEF\u7531</span>
<span class="token operator">&lt;</span>HashRouter<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>HashRouter<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u6837\u5F0F\u9694\u79BB\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_2-\u6837\u5F0F\u9694\u79BB\u95EE\u9898" aria-hidden="true">#</a> 2. \u6837\u5F0F\u9694\u79BB\u95EE\u9898</h3><p><strong>\u95EE\u9898</strong>\uFF1A\u5FAE\u5E94\u7528\u6837\u5F0F\u5F71\u54CD\u4E3B\u5E94\u7528</p><p><strong>\u89E3\u51B3\u65B9\u6848</strong>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u65B9\u68481\uFF1A\u542F\u7528\u6837\u5F0F\u9694\u79BB</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">sandbox</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">strictStyleIsolation</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u4E25\u683C\u6837\u5F0F\u9694\u79BB</span>
    <span class="token comment">// \u6216</span>
    <span class="token literal-property property">experimentalStyleIsolation</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// \u5B9E\u9A8C\u6027\u6837\u5F0F\u9694\u79BB</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u65B9\u68482\uFF1A\u4F7F\u7528scoped\u6216css module\u8FDB\u884C\u6837\u5F0F\u9694\u79BB</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u5168\u5C40\u53D8\u91CF\u6C61\u67D3" tabindex="-1"><a class="header-anchor" href="#_3-\u5168\u5C40\u53D8\u91CF\u6C61\u67D3" aria-hidden="true">#</a> 3. \u5168\u5C40\u53D8\u91CF\u6C61\u67D3</h3><p><strong>\u95EE\u9898</strong>\uFF1A\u5FAE\u5E94\u7528\u5168\u5C40\u53D8\u91CF\u6C61\u67D3\u4E3B\u5E94\u7528</p><p><strong>\u89E3\u51B3\u65B9\u6848</strong>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4F7F\u7528JS\u6C99\u7BB1</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">sandbox</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">loose</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// \u4E25\u683C\u6C99\u7BB1\u6A21\u5F0F</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u6216\u5728\u5FAE\u5E94\u7528\u4E2D\u907F\u514D\u5168\u5C40\u53D8\u91CF</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>
  <span class="token comment">// \u5FAE\u5E94\u7528\u4EE3\u7801</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-\u8D44\u6E90\u52A0\u8F7D\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_4-\u8D44\u6E90\u52A0\u8F7D\u95EE\u9898" aria-hidden="true">#</a> 4. \u8D44\u6E90\u52A0\u8F7D\u95EE\u9898</h3><p><strong>\u95EE\u9898</strong>\uFF1A\u5FAE\u5E94\u7528\u8D44\u6E90\u52A0\u8F7D\u5931\u8D25</p><p><strong>\u89E3\u51B3\u65B9\u6848</strong>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u8BBE\u7F6Epublic-path</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  __webpack_public_path__ <span class="token operator">=</span> window<span class="token punctuation">.</span>__INJECTED_PUBLIC_PATH_BY_QIANKUN__<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// webpack\u914D\u7F6E</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">publicPath</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;/micro-app/&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;/&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-\u901A\u4FE1\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_5-\u901A\u4FE1\u95EE\u9898" aria-hidden="true">#</a> 5. \u901A\u4FE1\u95EE\u9898</h3><p><strong>\u95EE\u9898</strong>\uFF1A\u4E3B\u5E94\u7528\u548C\u5FAE\u5E94\u7528\u901A\u4FE1\u56F0\u96BE</p><p><strong>\u89E3\u51B3\u65B9\u6848</strong>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4F7F\u7528\u5168\u5C40\u72B6\u6001</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token function">initGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u4E3B\u5E94\u7528\u76D1\u542C</span>
actions<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u4E3B\u5E94\u7528\u6536\u5230\u72B6\u6001\u53D8\u5316:&#39;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5FAE\u5E94\u7528\u4F7F\u7528</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u5FAE\u5E94\u7528\u6536\u5230\u72B6\u6001\u53D8\u5316:&#39;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// \u8BBE\u7F6E\u72B6\u6001</span>
  props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;\u5F20\u4E09&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-\u6027\u80FD\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#_6-\u6027\u80FD\u4F18\u5316" aria-hidden="true">#</a> 6. \u6027\u80FD\u4F18\u5316</h3><p><strong>\u95EE\u9898</strong>\uFF1A\u5FAE\u5E94\u7528\u52A0\u8F7D\u6027\u80FD\u5DEE</p><p><strong>\u89E3\u51B3\u65B9\u6848</strong>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u9884\u52A0\u8F7D</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u9884\u52A0\u8F7D\u6240\u6709\u5FAE\u5E94\u7528</span>
  <span class="token comment">// \u6216</span>
  <span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;app1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;app2&#39;</span><span class="token punctuation">]</span> <span class="token comment">// \u9884\u52A0\u8F7D\u6307\u5B9A\u5E94\u7528</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u8D44\u6E90\u7F13\u5B58</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">fetch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;/api/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// API\u8BF7\u6C42\u4E0D\u7F13\u5B58</span>
      <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u9759\u6001\u8D44\u6E90\u7F13\u5B58</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>args<span class="token punctuation">,</span>
      <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token string">&#39;force-cache&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6700\u4F73\u5B9E\u8DF5" tabindex="-1"><a class="header-anchor" href="#\u6700\u4F73\u5B9E\u8DF5" aria-hidden="true">#</a> \u6700\u4F73\u5B9E\u8DF5</h2><h3 id="_1-\u5E94\u7528\u62C6\u5206\u539F\u5219" tabindex="-1"><a class="header-anchor" href="#_1-\u5E94\u7528\u62C6\u5206\u539F\u5219" aria-hidden="true">#</a> 1. \u5E94\u7528\u62C6\u5206\u539F\u5219</h3><ul><li><strong>\u6309\u4E1A\u52A1\u9886\u57DF\u62C6\u5206</strong>\uFF1A\u6BCF\u4E2A\u5FAE\u5E94\u7528\u8D1F\u8D23\u4E00\u4E2A\u660E\u786E\u7684\u4E1A\u52A1\u9886\u57DF</li><li><strong>\u4FDD\u6301\u72EC\u7ACB\u6027</strong>\uFF1A\u5FAE\u5E94\u7528\u5E94\u8BE5\u80FD\u591F\u72EC\u7ACB\u5F00\u53D1\u3001\u6D4B\u8BD5\u3001\u90E8\u7F72</li><li><strong>\u5408\u7406\u7C92\u5EA6</strong>\uFF1A\u65E2\u4E0D\u8981\u8FC7\u5EA6\u62C6\u5206\uFF0C\u4E5F\u4E0D\u8981\u7C92\u5EA6\u8FC7\u5927</li></ul><h3 id="_2-\u6280\u672F\u6808\u9009\u62E9" tabindex="-1"><a class="header-anchor" href="#_2-\u6280\u672F\u6808\u9009\u62E9" aria-hidden="true">#</a> 2. \u6280\u672F\u6808\u9009\u62E9</h3><ul><li><strong>\u4E3B\u5E94\u7528</strong>\uFF1A\u9009\u62E9\u7A33\u5B9A\u3001\u8F7B\u91CF\u7684\u6280\u672F\u6808\uFF0C\u5982\u539F\u751FJS\u3001jQuery</li><li><strong>\u5FAE\u5E94\u7528</strong>\uFF1A\u53EF\u4EE5\u4F7F\u7528\u4E0D\u540C\u6280\u672F\u6808\uFF0C\u5982React\u3001Vue\u3001Angular</li><li><strong>\u5171\u540C\u4F9D\u8D56</strong>\uFF1A\u5C06\u516C\u5171\u5E93\u653E\u5728\u4E3B\u5E94\u7528\u4E2D\uFF0C\u51CF\u5C11\u91CD\u590D\u52A0\u8F7D</li></ul><h3 id="_3-\u72B6\u6001\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#_3-\u72B6\u6001\u7BA1\u7406" aria-hidden="true">#</a> 3. \u72B6\u6001\u7BA1\u7406</h3><ul><li><strong>\u5C40\u90E8\u72B6\u6001</strong>\uFF1A\u5FAE\u5E94\u7528\u5185\u90E8\u72B6\u6001\u81EA\u5DF1\u7BA1\u7406</li><li><strong>\u5168\u5C40\u72B6\u6001</strong>\uFF1A\u7528\u6237\u4FE1\u606F\u3001\u4E3B\u9898\u7B49\u901A\u8FC7qiankun\u5168\u5C40\u72B6\u6001\u7BA1\u7406</li><li><strong>\u4E1A\u52A1\u72B6\u6001</strong>\uFF1A\u8DE8\u5E94\u7528\u7684\u4E1A\u52A1\u72B6\u6001\u53EF\u4EE5\u901A\u8FC7API\u6216\u4E8B\u4EF6\u603B\u7EBF\u901A\u4FE1</li></ul><h3 id="_4-\u6837\u5F0F\u89C4\u8303" tabindex="-1"><a class="header-anchor" href="#_4-\u6837\u5F0F\u89C4\u8303" aria-hidden="true">#</a> 4. \u6837\u5F0F\u89C4\u8303</h3><ul><li><strong>CSS Module</strong>\uFF1A\u63A8\u8350\u4F7F\u7528CSS Module\u907F\u514D\u6837\u5F0F\u51B2\u7A81</li><li><strong>BEM\u547D\u540D</strong>\uFF1A\u4F7F\u7528BEM\u547D\u540D\u89C4\u8303</li><li><strong>\u4F5C\u7528\u57DF\u9694\u79BB</strong>\uFF1A\u4E3A\u6BCF\u4E2A\u5FAE\u5E94\u7528\u6DFB\u52A0\u552F\u4E00\u7684CSS\u4F5C\u7528\u57DF</li></ul><h3 id="_5-\u90E8\u7F72\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_5-\u90E8\u7F72\u7B56\u7565" aria-hidden="true">#</a> 5. \u90E8\u7F72\u7B56\u7565</h3><ul><li><strong>\u72EC\u7ACB\u90E8\u7F72</strong>\uFF1A\u6BCF\u4E2A\u5FAE\u5E94\u7528\u72EC\u7ACB\u90E8\u7F72\u5230\u4E0D\u540C\u57DF\u540D\u6216\u8DEF\u5F84</li><li><strong>\u7248\u672C\u63A7\u5236</strong>\uFF1A\u4E3B\u5E94\u7528\u914D\u7F6E\u5FAE\u5E94\u7528\u7248\u672C\uFF0C\u652F\u6301\u7070\u5EA6\u53D1\u5E03</li><li><strong>CDN\u4F18\u5316</strong>\uFF1A\u9759\u6001\u8D44\u6E90\u90E8\u7F72\u5230CDN\uFF0C\u63D0\u9AD8\u52A0\u8F7D\u901F\u5EA6</li></ul><h3 id="_6-\u76D1\u63A7\u548C\u9519\u8BEF\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_6-\u76D1\u63A7\u548C\u9519\u8BEF\u5904\u7406" aria-hidden="true">#</a> 6. \u76D1\u63A7\u548C\u9519\u8BEF\u5904\u7406</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u9519\u8BEF\u8FB9\u754C</span>
<span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;\u5FAE\u5E94\u7528\u9519\u8BEF:&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u4E0A\u62A5\u9519\u8BEF</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reportError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">reportError</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u53D1\u9001\u9519\u8BEF\u4FE1\u606F\u5230\u76D1\u63A7\u670D\u52A1</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/error-report&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">error</span><span class="token operator">:</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
        <span class="token literal-property property">stack</span><span class="token operator">:</span> error<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
        <span class="token literal-property property">componentStack</span><span class="token operator">:</span> errorInfo<span class="token punctuation">.</span>componentStack
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>\u5E94\u7528\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-\u5F00\u53D1\u8C03\u8BD5" tabindex="-1"><a class="header-anchor" href="#_7-\u5F00\u53D1\u8C03\u8BD5" aria-hidden="true">#</a> 7. \u5F00\u53D1\u8C03\u8BD5</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5F00\u53D1\u73AF\u5883\u914D\u7F6E</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u542F\u7528\u8BE6\u7EC6\u65E5\u5FD7</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">sandbox</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">loose</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">singular</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fetch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u8BF7\u6C42URL:&#39;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a> \u603B\u7ED3</h2><p>qiankun\u5FAE\u524D\u7AEF\u67B6\u6784\u4E3A\u5927\u578B\u524D\u7AEF\u9879\u76EE\u63D0\u4F9B\u4E86\u4E00\u4E2A\u4F18\u96C5\u7684\u89E3\u51B3\u65B9\u6848\uFF0C\u901A\u8FC7\u5408\u7406\u7684\u5E94\u7528\u62C6\u5206\u3001\u7EDF\u4E00\u7684\u8DEF\u7531\u7BA1\u7406\u3001\u5B8C\u5584\u7684\u901A\u4FE1\u673A\u5236\uFF0C\u53EF\u4EE5\u6709\u6548\u89E3\u51B3\u5927\u578B\u5355\u4F53\u5E94\u7528\u7684\u5F00\u53D1\u548C\u7EF4\u62A4\u96BE\u9898\u3002</p><p>\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u6211\u4EEC\u9700\u8981\u6839\u636E\u5177\u4F53\u4E1A\u52A1\u9700\u6C42\u9009\u62E9\u5408\u9002\u7684\u62C6\u5206\u7B56\u7565\uFF0C\u5236\u5B9A\u7EDF\u4E00\u7684\u5F00\u53D1\u89C4\u8303\uFF0C\u5EFA\u7ACB\u5B8C\u5584\u7684\u76D1\u63A7\u548C\u9519\u8BEF\u5904\u7406\u673A\u5236\uFF0C\u624D\u80FD\u771F\u6B63\u53D1\u6325\u5FAE\u524D\u7AEF\u67B6\u6784\u7684\u4F18\u52BF\u3002</p>`,117);function y(h,f){const p=e("ExternalLinkIcon");return o(),c("div",null,[u,s("p",null,[r,s("a",k,[d,i(p)]),v,m,b]),g])}var _=t(l,[["render",y],["__file","qiankun1.html.vue"]]);export{_ as default};
